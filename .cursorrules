# 测试设计助手系统 - Cursor 项目配置

## ⚠️ 重要：每次对话开始时的必须操作
1. **查看升级路线**：先查看 `docs/升级功能开发路线图.md` 了解升级功能开发路线、任务清单和时间安排（最主要参考）
2. **查看详细设计**：查看 `docs/升级功能实现详细设计.md` 了解升级功能详细设计和实现步骤（主要参考）
3. **查看开发进度**：查看 `docs/开发进度报告与路线图.md` 了解已完成功能和项目状态（作为参考）
4. **理解架构设计**：参考 `docs/07_测试设计助手系统架构设计方案.md` 和 `docs/08_核心模块详细设计-测试设计助手系统.md`
5. **遵循开发规范**：参考 `docs/优化后的开发Prompt.md` 中的开发规范

## 项目上下文
这是一个基于 MaaS 大模型应用开发平台的测试设计助手系统，为保险行业个险核心系统提供智能化测试设计支持。

### 系统定位
系统包含两个核心模块：
1. **标准化测试设计流程模块**：建设标准化的测试设计工作台，实现测试设计的全面线上化
2. **提示词工程用例生成模块**：基于大语言模型和提示词工程，自动生成高质量测试用例

## 项目结构
```
test-genius/
├── backend-java/                    # Java后端服务（核心业务）
│   └── test-design-assistant-core/  # Spring Boot 3.x 应用
│       └── src/main/java/com/sinosoft/testdesign/
│           ├── controller/          # REST API 控制器
│           ├── service/             # 业务服务层
│           ├── repository/          # 数据访问层（JPA）
│           ├── entity/              # 实体类（对应数据库表）
│           ├── dto/                 # 数据传输对象
│           ├── enums/               # 枚举类
│           ├── config/              # 配置类
│           └── common/              # 公共类（Result、异常处理等）
│
├── backend-python/                  # Python后端服务（AI能力）
│   └── ai-service/                  # FastAPI 应用
│       └── app/
│           ├── api/                 # API 路由
│           ├── services/            # 业务服务（LLM、用例生成等）
│           ├── models/              # 数据模型
│           └── utils/               # 工具类
│
├── frontend/                        # 前端项目
│   └── src/
│       ├── views/                   # 页面组件
│       ├── api/                     # API 接口封装
│       ├── store/                   # Pinia 状态管理
│       ├── router/                  # 路由配置
│       └── utils/                   # 工具函数
│
├── database/                        # 数据库脚本
│   └── init/                        # 初始化脚本
│
└── docs/                            # 文档目录
```

## 技术栈
- **后端Java**: Java 17 + Spring Boot 3.x + Spring Data JPA + MySQL
- **AI服务**: Python 3.10+ + FastAPI + LangChain + 多模型支持（DeepSeek、豆包、Kimi、千问等）
- **前端**: Vue 3 + Element Plus + TypeScript + Vite + Pinia
- **数据库**: MySQL（主数据库）
- **中间件**: Redis（缓存）、RocketMQ（消息队列，可选）
- **UI自动化**: Selenium、Playwright（测试执行模块）
- **页面解析**: BeautifulSoup、lxml（HTML解析）

## 核心实体和业务规则

### 核心实体类

**基础实体类**：
- `TestRequirement` - 测试需求（编码格式：REQ-YYYYMMDD-序号）
- `TestCase` - 测试用例（编码格式：CASE-YYYYMMDD-序号）
- `PromptTemplate` - 提示词模板（编码格式：TMP-YYYYMMDD-序号）
- `TestLayer` - 测试分层（个人级、业务案例、功能案例、接口案例、场景案例）
- `TestDesignMethod` - 测试设计方法（等价类、边界值、场景法、决策表、状态转换）
- `ModelConfig` - 模型配置
- `CaseGenerationTask` - 用例生成任务

**升级功能实体类（待实现）**：
- `TestExecutionTask` - 测试执行任务（编码格式：TASK-YYYYMMDD-序号）
- `TestExecutionRecord` - 测试执行记录（编码格式：REC-YYYYMMDD-序号）
- `UIScriptTemplate` - UI脚本模板（编码格式：TMP-YYYYMMDD-序号）
- `PageElementInfo` - 页面元素信息
- `TestReport` - 测试报告（编码格式：RPT-YYYYMMDD-序号）
- `TestReportTemplate` - 测试报告模板（编码格式：TMP-YYYYMMDD-序号）
- `TestCoverageAnalysis` - 测试覆盖分析（编码格式：COV-YYYYMMDD-序号）
- `TestRiskAssessment` - 风险评估（编码格式：RISK-YYYYMMDD-序号）

### 状态流转规则
- **需求状态**: 草稿 → 审核中 → 已通过/已关闭
- **用例状态**: 草稿 → 待审核 → 已审核/已废弃
- **生成任务状态**: PENDING → PROCESSING → SUCCESS/FAILED
- **执行任务状态**: PENDING → PROCESSING → SUCCESS/FAILED
- **执行记录状态**: PENDING → RUNNING → SUCCESS/FAILED/SKIPPED
- **报告状态**: DRAFT → PUBLISHED

### 业务规则
- 编码在创建时自动生成，不允许修改
- 已通过或已关闭的需求不能删除
- 已审核的用例不能删除，需要先废弃
- 提交审核的用例必须填写测试步骤和预期结果
- 状态流转遵循业务规则，不允许非法流转

## 开发规范

### 代码风格
- **Java**: 遵循 Google Java Style Guide，使用 Lombok 简化代码
- **Python**: 遵循 PEP 8 规范，使用类型注解
- **TypeScript**: 遵循 ESLint 规则，严格类型检查
- **命名规范**:
  - Java: 驼峰命名（类名大驼峰，方法/变量小驼峰）
  - Python: 蛇形命名（snake_case）
  - TypeScript: 驼峰命名（类名大驼峰，方法/变量小驼峰）

### 架构模式
- **分层架构**: Controller → Service → Repository → Entity
- **统一响应格式**: 使用 `Result<T>` 封装所有 API 响应
- **统一异常处理**: 使用 `GlobalExceptionHandler` 处理异常
- **DTO 模式**: Controller 层使用 DTO，Service 层使用 Entity

### API 设计规范
- RESTful API 设计，使用标准 HTTP 方法（GET/POST/PUT/DELETE）
- 统一响应格式：`{ code: 200, message: "操作成功", data: {} }`
- 统一错误码：200-成功，400-参数错误，401-未授权，404-资源不存在，500-服务器错误，600-业务异常
- 分页参数：`page`（页码，从1开始）、`size`（每页数量）
- API 路径：`/api/v1/{resource}`

### 数据库设计规范
- 使用 JPA 注解定义实体类
- 表名使用下划线命名（snake_case）
- 主键使用 `@GeneratedValue(strategy = GenerationType.IDENTITY)`
- 时间字段统一使用 `LocalDateTime`
- 软删除字段使用 `is_deleted`（0-未删除，1-已删除）
- 状态字段使用枚举值或字符串

### 注释和文档
- 所有公共类、方法必须有 JavaDoc 注释
- 复杂业务逻辑必须有行内注释说明
- API 接口使用 Swagger/OpenAPI 注解
- 关键配置项必须有注释说明

### 测试要求
- 核心业务逻辑必须有单元测试
- Service 层测试覆盖率达到 80% 以上
- Controller 层必须有集成测试
- 测试类命名：`{ClassName}Test`

## 开发工作流程

### 新功能开发流程
1. **查看文档**: 先查看 `docs/开发进度报告与路线图.md` 了解任务详情
2. **理解需求**: 参考相关设计文档理解业务需求
3. **代码实现**: 
   - 后端：Entity → Repository → Service → Controller
   - 前端：API 封装 → 页面组件 → 路由配置
4. **编写测试**: 编写单元测试和集成测试
5. **更新文档**: 更新 `docs/开发进度报告与路线图.md`，标注完成状态和进度百分比
6. **代码审查**: 确保代码符合规范和最佳实践

### 代码修改流程
1. **理解现有代码**: 先阅读相关代码，理解现有实现
2. **保持一致性**: 确保修改与现有架构和代码风格保持一致
3. **测试验证**: 修改后运行测试，确保功能正常
4. **更新文档**: 如有接口变更，更新 `docs/API接口文档.md`

### 常见任务
- **新增实体**: Entity → Repository → Service → Controller → DTO → API 文档
- **新增 API**: Controller → Service → Repository → 前端 API 封装 → 前端页面
- **新增前端页面**: 页面组件 → API 调用 → 路由配置 → 菜单配置（如有）

## 关键文件路径

### 后端 Java
- 配置文件: `backend-java/test-design-assistant-core/src/main/resources/application.yml`
- 实体类: `backend-java/test-design-assistant-core/src/main/java/com/sinosoft/testdesign/entity/`
- 服务层: `backend-java/test-design-assistant-core/src/main/java/com/sinosoft/testdesign/service/`
- 控制器: `backend-java/test-design-assistant-core/src/main/java/com/sinosoft/testdesign/controller/`
- 统一响应: `backend-java/test-design-assistant-core/src/main/java/com/sinosoft/testdesign/common/Result.java`

### 后端 Python
- 主入口: `backend-python/ai-service/app/main.py`
- API 路由: `backend-python/ai-service/app/api/`
- 服务层: `backend-python/ai-service/app/services/`
- 配置: `backend-python/ai-service/app/models/model_config.py`

### 前端
- API 封装: `frontend/src/api/`
- 页面组件: `frontend/src/views/`
- 路由配置: `frontend/src/router/index.ts`
- 状态管理: `frontend/src/store/`

### 数据库
- 初始化脚本: `database/init/01_init_tables.sql`
- 初始数据: `database/init/02_init_data.sql`

### 文档
- 开发规范: `docs/优化后的开发Prompt.md`
- 开发进度: `docs/开发进度报告与路线图.md`
- API 文档: `docs/API接口文档.md`
- 架构设计: `docs/07_测试设计助手系统架构设计方案.md`
- 模块设计: `docs/08_核心模块详细设计-测试设计助手系统.md`

## 注意事项

### 必须遵守
1. **开发前必读**: 新功能开发前必须先查看 `docs/升级功能开发路线图.md` 了解开发任务清单、时间安排和验收标准（最主要参考）
2. **查看详细设计**: 参考 `docs/升级功能实现详细设计.md` 了解升级功能详细设计和实现步骤（主要参考）
3. **参考已完成功能**: 参考 `docs/开发进度报告与路线图.md` 了解已完成功能的实现模式（作为参考）
4. **文档更新**: 完成任务后必须更新相关文档，标注完成状态和进度百分比
5. **代码一致性**: 代码修改时，确保与现有架构和设计保持一致
6. **参考实现**: 新功能开发时，参考已有的实现模式和代码风格

### 禁止事项
1. 不要修改自动生成的编码规则
2. 不要绕过状态流转的业务规则
3. 不要删除已审核的用例或已通过的需求
4. 不要直接修改数据库，使用迁移脚本

### 最佳实践
1. **错误处理**: 使用统一的异常处理机制，返回友好的错误信息
2. **日志记录**: 关键操作必须记录日志，使用统一的日志格式
3. **参数验证**: 所有输入参数必须进行验证
4. **事务管理**: 涉及多表操作时使用事务管理
5. **性能优化**: 查询列表时使用分页，避免全表扫描

## 升级功能开发路线

### 升级优先级
根据 `docs/升级功能开发路线图.md`，升级功能按以下优先级排序：

**P0 - 高优先级（必须实现）**：
1. **测试执行模块** - 完全缺失
   - UI脚本生成：以自然语言为输入，结合页面代码信息，生成可执行的UI自动化脚本
   - UI脚本修复：以UI脚本为输入，结合报错信息和页面代码信息，修复执行失败的UI自动化脚本
   - 测试执行管理：管理测试执行任务、执行结果、执行日志
   - 页面代码理解：解析和理解页面代码结构
   - 元素定位：智能定位页面元素

2. **测试评估模块** - 部分缺失
   - 测试报告生成：自动生成测试报告，支持多种报告模板
   - 测试结果评估：分析测试执行结果，提供质量建议
   - 测试覆盖分析：分析测试覆盖情况，生成覆盖报告
   - 风险评估：评估交付风险与上线可行性
   - 投产前检查：投产前检查清单和检查报告

**P1 - 中优先级（建议实现）**：
3. **规约驱动测试设计** - 部分缺失
   - 测试规约管理：应用级规约、公共规约管理
   - 规约版本管理：规约版本控制
   - 规约检查：规约符合性检查
   - 字段测试要点、逻辑测试要点等规约内容管理

4. **设计文档生成** - 完全缺失
   - 场景图、路径图生成
   - 等价类表、正交表生成
   - 图形化文档生成和导出

### 升级功能实现步骤

**详细开发计划请参考 `docs/升级功能开发路线图.md`**，包含：
- 第一阶段：测试执行模块（8周）- 基础功能、UI脚本生成、UI脚本修复、测试执行管理、前端界面
- 第二阶段：测试评估模块（6周）- 测试报告生成、测试覆盖分析、风险评估
- 第三阶段：规约驱动测试设计（4周）- 测试规约管理、规约检查和应用
- 第四阶段：设计文档生成（3周）- 流程文档生成、数据文档生成

**技术实现细节请参考 `docs/升级功能实现详细设计.md`**，包含数据模型、功能模块、技术实现方案

## 参考文档优先级
1. **升级功能开发路线图**（最主要参考）: `docs/升级功能开发路线图.md` - 升级功能开发路线、任务清单、时间安排、验收标准、里程碑，包含详细的开发计划和实施步骤
2. **升级功能详细设计**（主要参考）: `docs/升级功能实现详细设计.md` - 升级功能详细设计和实现步骤，包含数据模型、功能模块、技术实现方案
3. **差异分析报告**: `docs/OCR识别结果与项目实现差异报告.md` - 了解功能差异和缺失，明确待实现功能
4. **开发进度报告**（参考）: `docs/开发进度报告与路线图.md` - 了解已完成功能和实现模式，作为参考
5. **开发规范**: `docs/优化后的开发Prompt.md` - 开发规范和最佳实践
6. **架构设计**: `docs/07_测试设计助手系统架构设计方案.md` - 系统架构
7. **模块设计**: `docs/08_核心模块详细设计-测试设计助手系统.md` - 模块详细设计
8. **API 文档**: `docs/API接口文档.md` - API 接口规范
