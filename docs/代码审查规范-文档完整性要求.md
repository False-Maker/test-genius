# 代码审查规范 - 文档完整性要求

## 1. 概述

本文档规定了测试设计助手系统代码审查中关于文档完整性的要求，确保代码具有良好的可维护性和可读性。

## 2. Java代码文档要求

### 2.1 类文档要求

所有公共类必须包含JavaDoc注释，至少包括：

```java
/**
 * 类功能描述
 * 
 * @author 作者名
 * @date 创建日期
 */
public class ExampleService {
    // ...
}
```

**必需内容**：
- 类的功能描述
- `@author` 标签
- `@date` 标签

**可选内容**：
- `@since` 版本号
- `@see` 相关类或方法
- `@deprecated` 如果类已废弃

### 2.2 方法文档要求

所有公共方法（包括接口方法）必须包含JavaDoc注释：

```java
/**
 * 方法功能描述
 * 
 * @param paramName 参数说明
 * @return 返回值说明
 * @throws ExceptionType 异常说明
 */
public ReturnType methodName(ParamType paramName) throws ExceptionType {
    // ...
}
```

**必需内容**：
- 方法功能描述
- `@param` 标签（每个参数）
- `@return` 标签（有返回值的方法）
- `@throws` 标签（可能抛出的异常）

**例外情况**：
- Getter/Setter方法可以省略JavaDoc（如果字段已有注释）
- 简单的工具方法可以简化注释

### 2.3 字段文档要求

公共字段和常量应包含JavaDoc注释：

```java
/**
 * 字段说明
 */
private String fieldName;

/**
 * 常量说明
 */
public static final String CONSTANT_NAME = "value";
```

### 2.4 Controller文档要求

Controller类和方法必须包含Swagger注解：

```java
@Tag(name = "模块名称", description = "模块描述")
@RestController
@RequestMapping("/v1/example")
public class ExampleController {
    
    @Operation(summary = "接口摘要", description = "接口详细描述")
    @PostMapping
    public Result<ResponseType> create(@RequestBody RequestType request) {
        // ...
    }
}
```

**必需注解**：
- `@Tag` 在类上
- `@Operation` 在每个接口方法上
- `@Parameter` 在复杂参数上（可选）

## 3. Python代码文档要求

### 3.1 模块文档要求

每个Python模块文件开头应包含模块级Docstring：

```python
"""
模块功能描述
详细说明模块的用途和主要功能
"""
```

### 3.2 类文档要求

所有类必须包含类级Docstring：

```python
class ExampleService:
    """
    类功能描述
    
    详细说明类的职责和主要方法。
    
    Attributes:
        attr_name: 属性说明
        
    Example:
        >>> service = ExampleService()
        >>> result = service.method()
    """
```

**必需内容**：
- 类的功能描述
- 主要方法说明（可选）

**可选内容**：
- `Attributes` 部分（公共属性）
- `Example` 部分（使用示例）

### 3.3 函数/方法文档要求

所有公共函数和方法必须包含Docstring（遵循Google风格）：

```python
def function_name(param1: str, param2: int) -> Dict[str, Any]:
    """
    函数功能描述
    
    Args:
        param1: 参数1说明
        param2: 参数2说明
        
    Returns:
        返回值说明，包括返回的数据结构
        
    Raises:
        ValueError: 参数验证失败时抛出
        RuntimeError: 运行时错误时抛出
        
    Example:
        >>> result = function_name("value", 10)
        >>> print(result)
    """
```

**必需内容**：
- 函数功能描述
- `Args` 部分（每个参数）
- `Returns` 部分（有返回值）
- `Raises` 部分（可能抛出的异常）

### 3.4 FastAPI路由文档要求

FastAPI路由函数应包含详细的Docstring，FastAPI会自动生成API文档：

```python
@router.post("/endpoint", response_model=ResponseModel)
async def create_item(request: RequestModel, db: Session = Depends(get_db)):
    """
    创建项目
    
    详细描述接口的功能、参数和返回值。
    
    Args:
        request: 请求模型，包含...
        db: 数据库会话（自动注入）
        
    Returns:
        ResponseModel: 响应模型，包含...
        
    Raises:
        HTTPException: 400 - 参数验证失败
        HTTPException: 500 - 服务器内部错误
    """
```

## 4. API文档要求

### 4.1 Swagger/OpenAPI配置

Java后端使用SpringDoc OpenAPI，配置要求：

```yaml
# application.yml
springdoc:
  api-docs:
    path: /api-docs
  swagger-ui:
    path: /swagger-ui.html
    enabled: true
```

### 4.2 API文档完整性检查

所有REST API接口必须：
1. 包含`@Operation`注解（Java）或详细Docstring（Python）
2. 参数有清晰的说明
3. 返回值有明确的类型定义
4. 异常情况有说明

## 5. 文档检查工具

### 5.1 使用检查脚本

项目提供了文档完整性检查工具：

**Java代码检查**：
```bash
bash scripts/check-java-docs.sh
```

**Python代码检查**：
```bash
bash scripts/check-python-docs.sh
```

**统一检查（推荐）**：
```bash
python scripts/check-docs.py
```

### 5.2 检查标准

文档覆盖率要求：
- **类/模块文档覆盖率**：≥ 90%
- **方法/函数文档覆盖率**：≥ 80%
- **公共API文档覆盖率**：100%

## 6. 代码审查检查清单

在代码审查时，检查以下项目：

### Java代码
- [ ] 所有公共类都有JavaDoc注释
- [ ] 所有公共方法都有JavaDoc注释（包括参数和返回值说明）
- [ ] Controller类和方法都有Swagger注解
- [ ] 异常类和方法有说明
- [ ] 复杂业务逻辑有注释说明

### Python代码
- [ ] 所有模块文件都有模块级Docstring
- [ ] 所有类都有类级Docstring
- [ ] 所有公共函数/方法都有Docstring（包括Args、Returns、Raises）
- [ ] FastAPI路由函数有详细的Docstring
- [ ] 复杂算法有注释说明

### API文档
- [ ] 所有REST接口都有`@Operation`注解或详细Docstring
- [ ] 请求参数有说明
- [ ] 响应数据有说明
- [ ] 错误情况有说明

## 7. 文档更新要求

### 7.1 代码变更时

当代码发生以下变更时，必须同步更新文档：
- 方法签名变更（参数、返回值）
- 功能逻辑变更
- 新增公共接口
- 废弃功能

### 7.2 文档审查

在代码审查时，审查者应：
1. 检查文档是否与代码一致
2. 检查文档是否清晰易懂
3. 检查是否缺少必要的文档
4. 提出文档改进建议

## 8. 最佳实践

### 8.1 文档编写建议

1. **清晰简洁**：文档应清晰说明功能，避免冗余
2. **示例代码**：复杂功能提供使用示例
3. **参数说明**：详细说明参数的含义、取值范围、默认值
4. **异常说明**：明确说明可能抛出的异常及原因
5. **版本信息**：重要变更记录版本号

### 8.2 文档维护

1. **及时更新**：代码变更时同步更新文档
2. **定期审查**：定期使用检查工具审查文档完整性
3. **持续改进**：根据反馈不断改进文档质量

## 9. 工具和资源

### 9.1 文档生成工具

- **Java**: Javadoc
- **Python**: Sphinx, pydoc
- **API文档**: Swagger UI, ReDoc

### 9.2 参考资源

- [Google Java Style Guide](https://google.github.io/styleguide/javaguide.html)
- [PEP 257 - Docstring Conventions](https://www.python.org/dev/peps/pep-0257/)
- [Google Python Style Guide](https://google.github.io/styleguide/pyguide.html)
- [OpenAPI Specification](https://swagger.io/specification/)

## 10. 违规处理

如果代码审查发现文档不完整：

1. **轻微问题**：提醒补充文档，可以合并代码
2. **严重问题**：要求补充文档后才能合并
3. **重复违规**：在团队会议中讨论，加强规范意识

---

**文档版本**：v1.0  
**最后更新**：2024-01-01  
**维护者**：开发团队

