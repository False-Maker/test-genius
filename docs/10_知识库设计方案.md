# 知识库设计方案

## 1. 知识库概述

### 1.1 知识库定位
知识库是测试设计助手系统的核心支撑组件，为系统提供测试设计规范、保险业务知识、测试用例模板和历史用例等知识资源，支持智能用例生成和测试设计标准化。

### 1.2 知识库目标
- **知识积累**：积累测试设计经验和保险业务知识
- **知识共享**：实现测试团队知识共享和复用
- **知识应用**：支撑智能用例生成和测试设计
- **知识进化**：持续学习和优化知识库内容

### 1.3 知识库分类
- **测试设计规范知识库**：公司测试设计规范、行业标准、最佳实践
- **保险业务知识库**：保险业务规则、产品条款、业务流程
- **测试用例模板库**：不同测试分层和测试方法的用例模板
- **历史用例库**：历史测试用例，支持复用和参考

## 2. 知识库架构设计

### 2.1 架构分层

```
知识库架构
├── 知识获取层
│   ├── 文档采集
│   ├── 数据导入
│   └── 知识抽取
├── 知识存储层
│   ├── 关系型数据库（结构化知识）
│   ├── 向量数据库（语义检索）
│   ├── 图数据库（知识图谱）
│   └── 对象存储（文档存储）
├── 知识处理层
│   ├── 知识解析
│   ├── 知识结构化
│   ├── 知识向量化
│   └── 知识图谱构建
├── 知识应用层
│   ├── 知识检索
│   ├── 知识推荐
│   ├── 知识匹配
│   └── 知识推理
└── 知识管理层
    ├── 知识分类管理
    ├── 知识版本管理
    ├── 知识质量管理
    └── 知识访问控制
```

### 2.2 知识库组成

```
知识库
├── 测试设计规范知识库
│   ├── 公司测试设计规范文档
│   ├── 行业测试标准文档
│   ├── 测试设计最佳实践
│   └── 规范检查规则
├── 保险业务知识库
│   ├── 保险产品条款库
│   ├── 业务规则库
│   ├── 业务流程库
│   └── 业务术语库
├── 测试用例模板库
│   ├── 个人级测试模板
│   ├── 业务案例测试模板
│   ├── 功能案例测试模板
│   ├── 接口案例测试模板
│   └── 场景案例测试模板
└── 历史用例库
    ├── 投保模块用例库
    ├── 核保模块用例库
    ├── 理赔模块用例库
    ├── 保全模块用例库
    └── 其他模块用例库
```

## 3. 测试设计规范知识库

### 3.1 知识来源
- **公司内部规范**：公司测试设计规范文档、测试设计指导手册
- **行业标准**：ISO/IEC 29119软件测试标准、ISTQB测试标准
- **最佳实践**：业界测试设计最佳实践、测试设计案例
- **专家经验**：测试专家经验和知识

### 3.2 知识内容

#### 3.2.1 测试设计规范
- 测试用例编写规范
- 测试用例命名规范
- 测试用例分类规范
- 测试用例优先级定义
- 测试用例评审规范

#### 3.2.2 测试分层规范
- 个人级测试规范
- 业务案例测试规范
- 功能案例测试规范
- 接口案例测试规范
- 场景案例测试规范

#### 3.2.3 测试方法规范
- 等价类划分法使用规范
- 边界值分析法使用规范
- 场景法使用规范
- 决策表法使用规范
- 状态转换法使用规范

#### 3.2.4 规范检查规则
- 用例格式检查规则
- 用例完整性检查规则
- 用例可执行性检查规则
- 用例规范性检查规则

### 3.3 存储设计

**关系型数据库表结构**：
```sql
-- 测试设计规范表
CREATE TABLE test_design_specification (
    id BIGINT PRIMARY KEY,
    spec_code VARCHAR(100) UNIQUE NOT NULL,
    spec_name VARCHAR(500) NOT NULL,
    spec_category VARCHAR(100), -- 规范分类
    spec_version VARCHAR(50),
    spec_content TEXT, -- 规范内容
    spec_doc_url VARCHAR(1000), -- 规范文档路径
    effective_date DATE,
    expire_date DATE,
    is_active CHAR(1) DEFAULT '1',
    creator_id BIGINT,
    create_time TIMESTAMP,
    update_time TIMESTAMP
);

-- 规范检查规则表
CREATE TABLE spec_check_rule (
    id BIGINT PRIMARY KEY,
    spec_id BIGINT,
    rule_code VARCHAR(100),
    rule_name VARCHAR(500),
    rule_category VARCHAR(100), -- 规则分类
    rule_description TEXT,
    rule_type VARCHAR(50), -- 必填检查/格式检查/内容检查
    check_expression TEXT, -- 检查表达式
    error_message TEXT,
    priority INT, -- 优先级
    is_active CHAR(1) DEFAULT '1',
    FOREIGN KEY (spec_id) REFERENCES test_design_specification(id)
);

-- 规范文档表
CREATE TABLE spec_document (
    id BIGINT PRIMARY KEY,
    spec_id BIGINT,
    doc_name VARCHAR(500),
    doc_type VARCHAR(50), -- Word/PDF/Markdown
    doc_url VARCHAR(1000),
    doc_size BIGINT,
    upload_time TIMESTAMP,
    FOREIGN KEY (spec_id) REFERENCES test_design_specification(id)
);
```

**向量数据库存储**：
- 规范文档内容向量化，支持语义检索
- 存储规范关键词和概念的向量表示

## 4. 保险业务知识库

### 4.1 知识来源
- **产品条款**：各保险产品的条款文档
- **业务规则**：业务系统规则配置、业务规则文档
- **业务流程**：业务流程文档、流程图
- **业务术语**：保险业务术语词典
- **历史案例**：历史业务案例和处理经验

### 4.2 知识内容

#### 4.2.1 保险产品条款库
- 产品条款文档
- 条款关键信息提取
- 条款与测试点关联

#### 4.2.2 业务规则库
- 投保规则
- 核保规则
- 理赔规则
- 保全规则
- 续期规则

#### 4.2.3 业务流程库
- 投保流程
- 核保流程
- 理赔流程
- 保全流程
- 续期流程

#### 4.2.4 业务术语库
- 保险术语定义
- 术语关联关系
- 术语使用场景

### 4.3 存储设计

**关系型数据库表结构**：
```sql
-- 保险产品表
CREATE TABLE insurance_product (
    id BIGINT PRIMARY KEY,
    product_code VARCHAR(100) UNIQUE NOT NULL,
    product_name VARCHAR(500) NOT NULL,
    product_type VARCHAR(100),
    product_description TEXT,
    is_active CHAR(1) DEFAULT '1'
);

-- 产品条款表
CREATE TABLE product_clause (
    id BIGINT PRIMARY KEY,
    product_id BIGINT,
    clause_code VARCHAR(100),
    clause_name VARCHAR(500),
    clause_content TEXT,
    clause_category VARCHAR(100), -- 条款分类
    is_key_clause CHAR(1), -- 是否关键条款
    FOREIGN KEY (product_id) REFERENCES insurance_product(id)
);

-- 业务规则表
CREATE TABLE business_rule (
    id BIGINT PRIMARY KEY,
    rule_code VARCHAR(100) UNIQUE NOT NULL,
    rule_name VARCHAR(500) NOT NULL,
    rule_category VARCHAR(100), -- 规则分类：投保/核保/理赔/保全
    rule_type VARCHAR(100), -- 规则类型
    rule_content TEXT, -- 规则内容
    rule_expression TEXT, -- 规则表达式
    applicable_products VARCHAR(500), -- 适用产品
    is_active CHAR(1) DEFAULT '1',
    effective_date DATE,
    expire_date DATE
);

-- 业务流程表
CREATE TABLE business_process (
    id BIGINT PRIMARY KEY,
    process_code VARCHAR(100) UNIQUE NOT NULL,
    process_name VARCHAR(500) NOT NULL,
    process_category VARCHAR(100), -- 流程分类
    process_description TEXT,
    process_flow TEXT, -- 流程定义JSON
    applicable_modules VARCHAR(500), -- 适用模块
    is_active CHAR(1) DEFAULT '1'
);

-- 业务术语表
CREATE TABLE business_term (
    id BIGINT PRIMARY KEY,
    term_code VARCHAR(100) UNIQUE NOT NULL,
    term_name VARCHAR(200) NOT NULL,
    term_definition TEXT, -- 术语定义
    term_category VARCHAR(100), -- 术语分类
    related_terms VARCHAR(500), -- 相关术语
    usage_scenario TEXT -- 使用场景
);
```

**向量数据库存储**：
- 产品条款内容向量化
- 业务规则内容向量化
- 业务流程描述向量化
- 支持语义检索和匹配

**知识图谱存储**：
- 产品-条款关系
- 产品-规则关系
- 规则-规则关系
- 流程-规则关系
- 术语-术语关系

## 5. 测试用例模板库

### 5.1 知识来源
- **历史用例提炼**：从历史用例中提炼模板
- **专家经验**：测试专家总结的模板
- **业界模板**：业界测试用例模板

### 5.2 知识内容

#### 5.2.1 按测试分层分类的模板
- 个人级测试模板
- 业务案例测试模板
- 功能案例测试模板
- 接口案例测试模板
- 场景案例测试模板

#### 5.2.2 按测试方法分类的模板
- 等价类划分法模板
- 边界值分析法模板
- 场景法模板
- 决策表法模板
- 状态转换法模板

#### 5.2.3 按业务模块分类的模板
- 投保模块模板
- 核保模块模板
- 理赔模块模板
- 保全模块模板
- 客户管理模块模板

#### 5.2.4 按用例类型分类的模板
- 正常用例模板
- 异常用例模板
- 边界用例模板

### 5.3 存储设计

**关系型数据库表结构**：
```sql
-- 测试用例模板表
CREATE TABLE test_case_template (
    id BIGINT PRIMARY KEY,
    template_code VARCHAR(100) UNIQUE NOT NULL,
    template_name VARCHAR(500) NOT NULL,
    template_category VARCHAR(100), -- 模板分类
    layer_id BIGINT, -- 测试分层
    method_id BIGINT, -- 测试方法
    business_module VARCHAR(100), -- 业务模块
    case_type VARCHAR(50), -- 用例类型
    template_content TEXT, -- 模板内容
    template_example TEXT, -- 模板示例
    applicable_scenarios TEXT, -- 适用场景
    usage_count INT DEFAULT 0, -- 使用次数
    success_rate DECIMAL(5,2), -- 成功率
    is_active CHAR(1) DEFAULT '1',
    creator_id BIGINT,
    create_time TIMESTAMP,
    update_time TIMESTAMP,
    FOREIGN KEY (layer_id) REFERENCES test_layer(id),
    FOREIGN KEY (method_id) REFERENCES test_design_method(id)
);

-- 模板变量定义表
CREATE TABLE template_variable (
    id BIGINT PRIMARY KEY,
    template_id BIGINT,
    variable_name VARCHAR(100), -- 变量名
    variable_type VARCHAR(50), -- 变量类型
    variable_description TEXT, -- 变量说明
    is_required CHAR(1) DEFAULT '1', -- 是否必填
    default_value TEXT, -- 默认值
    FOREIGN KEY (template_id) REFERENCES test_case_template(id)
);
```

## 6. 历史用例库

### 6.1 知识来源
- **历史测试用例**：系统中已有的测试用例
- **测试执行结果**：用例执行历史记录
- **测试缺陷记录**：用例发现的缺陷记录

### 6.2 知识内容

#### 6.2.1 用例基本信息
- 用例名称和描述
- 用例分层和方法
- 用例类型和优先级
- 用例状态和执行结果

#### 6.2.2 用例内容
- 前置条件
- 测试步骤
- 预期结果
- 实际结果

#### 6.2.3 用例关联信息
- 关联需求
- 关联缺陷
- 关联测试执行记录
- 关联业务模块

#### 6.2.4 用例元数据
- 创建时间和创建人
- 修改时间和修改人
- 使用次数
- 复用次数

### 6.3 存储设计

**关系型数据库表结构**：
```sql
-- 历史用例表（复用test_case表，增加历史标记）
-- 已在核心模块详细设计中定义

-- 用例使用记录表
CREATE TABLE test_case_usage_log (
    id BIGINT PRIMARY KEY,
    case_id BIGINT,
    usage_type VARCHAR(50), -- 使用类型：参考/复用/组合
    usage_user_id BIGINT,
    usage_time TIMESTAMP,
    FOREIGN KEY (case_id) REFERENCES test_case(id)
);

-- 用例执行记录表
CREATE TABLE test_case_execution (
    id BIGINT PRIMARY KEY,
    case_id BIGINT,
    execution_time TIMESTAMP,
    execution_result VARCHAR(50), -- 通过/失败/阻塞
    execution_comment TEXT,
    executor_id BIGINT,
    FOREIGN KEY (case_id) REFERENCES test_case(id)
);

-- 用例缺陷关联表
CREATE TABLE test_case_defect (
    id BIGINT PRIMARY KEY,
    case_id BIGINT,
    defect_id VARCHAR(100), -- 缺陷ID
    defect_title VARCHAR(500),
    defect_severity VARCHAR(50), -- 缺陷严重程度
    FOREIGN KEY (case_id) REFERENCES test_case(id)
);
```

**向量数据库存储**：
- 用例内容向量化，支持语义相似度检索
- 用例名称和描述向量化
- 支持相似用例推荐

## 7. 知识库管理

### 7.1 知识采集

#### 7.1.1 文档采集
- 支持多种格式文档上传（Word、PDF、Markdown等）
- 文档自动解析和内容提取
- 文档结构化处理

#### 7.1.2 数据导入
- 支持批量导入结构化数据
- 支持从其他系统导入数据
- 数据格式验证和清洗

#### 7.1.3 知识抽取
- 自动从文档中抽取关键信息
- 实体识别和关系抽取
- 知识结构化处理

### 7.2 知识处理

#### 7.2.1 知识解析
- 文档内容解析
- 非结构化数据处理
- 关键信息提取

#### 7.2.2 知识结构化
- 知识分类和标签
- 知识关联关系建立
- 知识标准化处理

#### 7.2.3 知识向量化
- 文本向量化处理
- Embedding模型选择和应用
- 向量存储和索引

#### 7.2.4 知识图谱构建
- 实体和关系提取
- 知识图谱构建
- 知识图谱更新和维护

### 7.3 知识应用

#### 7.3.1 知识检索
- 关键词检索
- 语义检索（向量检索）
- 混合检索
- 高级检索（组合条件）

#### 7.3.2 知识推荐
- 基于相似度的推荐
- 基于关联关系的推荐
- 基于使用历史的推荐

#### 7.3.3 知识匹配
- 需求与知识的匹配
- 用例与模板的匹配
- 用例与历史用例的匹配

#### 7.3.4 知识推理
- 基于规则的推理
- 基于知识图谱的推理
- 关系推理

### 7.4 知识管理

#### 7.4.1 知识分类管理
- 多级分类体系
- 标签管理
- 分类权限控制

#### 7.4.2 知识版本管理
- 知识版本控制
- 版本历史追溯
- 版本比较和回退

#### 7.4.3 知识质量管理
- 知识质量评估
- 知识有效性检查
- 知识过期管理

#### 7.4.4 知识访问控制
- 基于角色的访问控制
- 知识权限管理
- 访问日志记录

## 8. 知识库技术选型

### 8.1 关系型数据库
**选型**：PostgreSQL / MySQL
**用途**：存储结构化知识数据

### 8.2 向量数据库
**选型**：Milvus / Chroma / PGVector
**用途**：存储向量化知识，支持语义检索

### 8.3 图数据库
**选型**：Neo4j / Nebula Graph
**用途**：存储知识图谱，支持关系查询

### 8.4 对象存储
**选型**：MinIO / OSS
**用途**：存储文档和附件

### 8.5 搜索引擎
**选型**：Elasticsearch
**用途**：全文检索和高级搜索

## 9. 知识库实施计划

### 9.1 第一阶段：基础知识库建设（1-2个月）
- 测试设计规范知识库初始化
- 基础业务知识库建设
- 基础用例模板库建设

### 9.2 第二阶段：知识库扩展（2-3个月）
- 完善各分类知识库内容
- 历史用例库建设
- 知识向量化和图谱构建

### 9.3 第三阶段：知识库优化（持续）
- 知识质量优化
- 知识更新和维护
- 知识应用效果优化

## 10. 知识库质量保障

### 10.1 知识质量评估标准
- 准确性：知识内容准确无误
- 完整性：知识内容完整全面
- 时效性：知识内容及时更新
- 一致性：知识内容保持一致

### 10.2 知识更新机制
- 定期更新：定期检查和更新知识
- 变更通知：知识变更及时通知
- 版本管理：知识版本规范管理

### 10.3 知识审核机制
- 知识入库审核
- 知识修改审核
- 知识删除审核

