# 工作流引擎选型报告

## 一、选型背景

参考 Dify 框架，需要为测试设计助手系统引入工作流引擎，将硬编码的流程升级为可视化可配置的工作流。

## 二、候选方案对比

### 方案1：Prefect

**优点**:
- Python 原生，易于集成到 Python AI 服务
- 支持复杂工作流
- 有可视化界面
- 支持动态工作流定义

**缺点**:
- 需要额外部署 Prefect Server
- 增加系统复杂度
- 对于简单工作流可能过于重量级

### 方案2：Airflow

**优点**:
- 功能强大，生态成熟
- 支持复杂调度和依赖管理
- 有丰富的插件生态

**缺点**:
- 重量级，配置复杂
- 主要用于数据管道和ETL场景
- 学习曲线陡峭
- 需要额外部署和维护

### 方案3：自研轻量级引擎（推荐）⭐

**优点**:
- 完全可控，轻量级
- 可以完美集成到现有系统
- 可以根据业务需求定制
- 不需要额外部署服务
- 易于维护和扩展

**缺点**:
- 开发工作量大
- 需要自己实现核心功能

## 三、选型结论

**推荐方案：自研轻量级工作流引擎**

**理由**:
1. **项目特点**：当前项目已有 Java 和 Python 服务，工作流主要用于编排 AI 服务调用，相对简单
2. **集成需求**：需要与现有系统深度集成，使用现有数据库和消息队列
3. **灵活性**：可以根据业务需求定制节点类型和执行逻辑
4. **维护性**：减少外部依赖，降低系统复杂度

## 四、技术架构设计

### 4.1 架构概述

```
前端（Vue 3 + vue-flow）
    ↓
Java 后端（工作流定义管理）
    ↓
Python AI 服务（工作流执行引擎）
    ↓
数据库（工作流定义、执行记录）
```

### 4.2 核心组件

1. **工作流定义管理**（Java）
   - 工作流 CRUD API
   - 工作流版本管理
   - 工作流验证

2. **工作流执行引擎**（Python）
   - 工作流解析
   - 节点执行器
   - 流程控制（顺序、分支、循环）

3. **可视化编辑器**（前端）
   - 使用 vue-flow 实现拖拽式编辑器
   - 节点配置面板
   - 工作流保存和加载

### 4.3 节点类型设计

1. **输入节点**
   - 需求文本输入
   - 测试用例输入
   - 文件上传

2. **处理节点**
   - 需求分析
   - 模板选择
   - 提示词生成
   - 模型调用
   - 结果解析

3. **转换节点**
   - 格式转换
   - 数据清洗
   - 数据合并

4. **输出节点**
   - 用例保存
   - 报告生成
   - 文件导出

5. **控制节点**
   - 条件判断（if/else）
   - 循环（for/while）

## 五、实施计划

### Phase 1: 基础架构（Week 1-2）
- 设计数据模型
- 实现工作流定义 API
- 实现基础工作流引擎

### Phase 2: 节点实现（Week 3-4）
- 实现各类节点
- 实现流程控制

### Phase 3: 可视化编辑器（Week 5-6）
- 集成 vue-flow
- 实现节点组件
- 实现配置面板

### Phase 4: 工作流迁移（Week 7-8）
- 迁移用例生成工作流
- 迁移 UI 脚本生成工作流
- 测试和文档

---

**文档版本**: v1.0  
**创建时间**: 2026-01-26  
**决策**: 采用自研轻量级工作流引擎
