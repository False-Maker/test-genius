# 测试设计助手系统 - 测试计划文档

## 一、文档信息

- **文档版本**: v1.0
- **创建日期**: 2024-01-XX
- **最后更新**: 2024-01-XX
- **适用项目**: 测试设计助手系统
- **测试负责人**: 测试团队

---

## 二、测试概述

### 2.1 测试目标

1. **质量保障**: 确保系统功能正确、稳定、可靠
2. **代码覆盖率**: 单元测试覆盖率目标 >70%，关键业务逻辑覆盖率 >90%
3. **性能验证**: 验证系统性能指标满足要求
4. **安全验证**: 确保系统安全性
5. **兼容性验证**: 确保系统在不同环境下正常运行

### 2.2 测试范围

#### 2.2.1 功能测试范围
- ✅ 需求管理模块（CRUD、状态流转、搜索）
- ✅ 用例管理模块（CRUD、审核、版本管理、搜索）
- ✅ 提示词模板管理模块（CRUD、变量解析、模板生成）
- ✅ 模型配置管理模块（CRUD、启用/禁用、查询）
- ✅ 用例生成功能（单次生成、批量生成、任务管理）
- ✅ 用例质量评估（完整性检查、规范性检查、质量评分）
- ✅ 用例导入导出（Excel导入、导出、模板导出）
- ✅ 需求分析功能（需求分析、测试要点提取、业务规则提取）
- ✅ 文件上传功能（Word、PDF上传、存储管理）
- ✅ 知识库功能（文档管理、语义检索、关键词检索）
- ✅ 用例复用功能（相似用例搜索、用例推荐、测试套件）

#### 2.2.2 非功能测试范围
- 性能测试（接口响应时间、并发处理能力）
- 安全测试（SQL注入、XSS攻击、权限控制）
- 兼容性测试（浏览器兼容性、数据库兼容性）
- 可用性测试（用户体验、界面友好性）

### 2.3 测试策略

#### 2.3.1 测试分层策略

```
┌─────────────────────────────────────┐
│        端到端测试 (E2E)              │  ← 用户场景验证
├─────────────────────────────────────┤
│        系统测试 (System)             │  ← 完整功能验证
├─────────────────────────────────────┤
│        集成测试 (Integration)        │  ← 模块间交互验证
├─────────────────────────────────────┤
│        单元测试 (Unit)              │  ← 代码逻辑验证
└─────────────────────────────────────┘
```

#### 2.3.2 测试类型

1. **单元测试** (Unit Test)
   - 测试对象：Service层、工具类
   - 测试工具：JUnit 5 + Mockito
   - 覆盖率目标：>70%

2. **集成测试** (Integration Test)
   - 测试对象：Controller层、Service层与Repository层交互
   - 测试工具：Spring Boot Test + TestContainers（可选）
   - 覆盖率目标：关键接口100%

3. **系统测试** (System Test)
   - 测试对象：完整业务流程
   - 测试工具：Postman、JMeter
   - 测试场景：端到端用户场景

4. **性能测试** (Performance Test)
   - 测试工具：JMeter、Gatling
   - 测试指标：响应时间、吞吐量、并发数

5. **安全测试** (Security Test)
   - 测试工具：OWASP ZAP、SQLMap
   - 测试内容：SQL注入、XSS、CSRF、权限控制

---

## 三、测试计划

### 3.1 第一阶段：单元测试补充（1-2周）

#### 3.1.1 Java后端Service层单元测试

**目标**: 补充所有Service层的单元测试，覆盖率>70%

**待测试Service列表**:

| Service | 优先级 | 状态 | 预计用例数 |
|---------|--------|------|-----------|
| RequirementServiceImpl | P0 | ✅ 已完成 | 15 |
| TestCaseServiceImpl | P0 | ✅ 已完成 | 11 |
| PromptTemplateServiceImpl | P0 | ⏸️ 待补充 | 12 |
| IntelligentCaseGenerationServiceImpl | P0 | ⏸️ 待补充 | 15 |
| ModelConfigServiceImpl | P1 | ⏸️ 待补充 | 10 |
| TestCaseQualityServiceImpl | P1 | ⏸️ 待补充 | 12 |
| RequirementAnalysisServiceImpl | P1 | ⏸️ 待补充 | 10 |
| TestCaseImportExportServiceImpl | P1 | ⏸️ 待补充 | 15 |
| FileUploadServiceImpl | P2 | ⏸️ 待补充 | 8 |
| CacheServiceImpl | P2 | ⏸️ 待补充 | 6 |
| AIServiceClientImpl | P2 | ⏸️ 待补充 | 10 |
| KnowledgeBaseServiceImpl | P2 | ⏸️ 待补充 | 8 |
| CaseReuseServiceImpl | P2 | ⏸️ 待补充 | 10 |

**测试内容**:
- 正常流程测试（Happy Path）
- 异常流程测试（异常输入、边界条件）
- 业务规则验证（状态流转、数据校验）
- 依赖Mock验证（Repository、外部服务）

**测试规范**:
- 使用JUnit 5 + Mockito
- 测试类命名：`{ServiceName}Test`
- 测试方法命名：`test{MethodName}_{Scenario}`
- 使用`@DisplayName`注解描述测试场景
- 遵循AAA模式（Arrange-Act-Assert）

#### 3.1.2 Python服务单元测试

**目标**: 创建Python服务的单元测试框架

**待测试模块列表**:

| 模块 | 优先级 | 状态 | 预计用例数 |
|------|--------|------|-----------|
| case_generation_service | P0 | ⏸️ 待补充 | 15 |
| prompt_service | P0 | ⏸️ 待补充 | 10 |
| llm_service | P0 | ⏸️ 待补充 | 12 |
| document_parser_service | P1 | ⏸️ 待补充 | 8 |
| knowledge_base_service | P2 | ⏸️ 待补充 | 10 |
| case_reuse_service | P2 | ⏸️ 待补充 | 10 |

**测试工具**: pytest + pytest-cov

**测试规范**:
- 测试文件命名：`test_{module_name}.py`
- 测试函数命名：`test_{function_name}_{scenario}`
- 使用fixture管理测试数据
- 使用mock模拟外部依赖

#### 3.1.3 前端单元测试

**目标**: 创建前端组件和工具函数的单元测试

**待测试内容**:
- API服务函数测试
- 工具函数测试
- 组件逻辑测试（可选）

**测试工具**: Vitest

---

### 3.2 第二阶段：集成测试框架（1周）

#### 3.2.1 集成测试框架搭建

**目标**: 创建集成测试框架，支持Controller层和Service层集成测试

**框架组件**:
1. **测试配置**
   - 测试环境配置（`application-test.yml`）
   - H2内存数据库配置（或TestContainers）
   - Mock外部服务配置

2. **测试基类**
   - `BaseIntegrationTest` - 基础集成测试类
   - `BaseControllerTest` - Controller测试基类
   - `BaseServiceTest` - Service测试基类

3. **测试工具类**
   - `TestDataBuilder` - 测试数据构建器
   - `MockUtils` - Mock工具类
   - `AssertUtils` - 断言工具类

4. **测试数据管理**
   - 测试数据初始化脚本
   - 测试数据清理机制

#### 3.2.2 Controller层集成测试

**目标**: 补充所有Controller层的集成测试

**待测试Controller列表**:

| Controller | 优先级 | 状态 | 预计用例数 |
|-----------|--------|------|-----------|
| RequirementController | P0 | ✅ 已完成 | 5 |
| TestCaseController | P0 | ⏸️ 待补充 | 12 |
| CaseGenerationController | P0 | ⏸️ 待补充 | 10 |
| PromptTemplateController | P1 | ⏸️ 待补充 | 10 |
| ModelConfigController | P1 | ⏸️ 待补充 | 8 |
| CommonController | P1 | ⏸️ 待补充 | 6 |
| TestCaseQualityController | P1 | ⏸️ 待补充 | 8 |
| FileUploadController | P2 | ⏸️ 待补充 | 6 |
| KnowledgeBaseController | P2 | ⏸️ 待补充 | 6 |
| CaseReuseController | P2 | ⏸️ 待补充 | 6 |

**测试内容**:
- HTTP请求/响应测试
- 参数验证测试
- 异常处理测试
- 权限控制测试（如需要）

**测试工具**: Spring Boot Test + MockMvc

---

### 3.3 第三阶段：系统测试（1-2周）

#### 3.3.1 功能测试

**测试场景**:

1. **需求管理流程**
   - 创建需求 → 更新需求 → 提交审核 → 审核通过/不通过 → 关闭需求
   - 需求搜索、分页查询

2. **用例管理流程**
   - 创建用例 → 提交审核 → 审核通过/不通过 → 废弃用例
   - 用例版本管理
   - 用例搜索、分页查询

3. **用例生成流程**
   - 选择需求 → 配置参数 → 提交生成任务 → 查询任务状态 → 查看生成结果
   - 批量生成流程

4. **用例质量评估流程**
   - 选择用例 → 执行质量评估 → 查看评估结果 → 查看优化建议

5. **用例导入导出流程**
   - 导出用例列表 → 编辑Excel → 导入用例 → 查看导入结果

#### 3.3.2 性能测试

**测试指标**:
- 接口响应时间：P95 < 1s，P99 < 2s
- 并发处理能力：支持100并发用户
- 数据库查询性能：复杂查询 < 500ms

**测试场景**:
- 单接口性能测试
- 并发压力测试
- 大数据量查询测试
- 用例生成性能测试

**测试工具**: JMeter、Gatling

#### 3.3.3 安全测试

**测试内容**:
- SQL注入测试
- XSS攻击测试
- CSRF攻击测试
- 权限控制测试
- 文件上传安全测试

**测试工具**: OWASP ZAP、Postman

---

### 3.4 第四阶段：端到端测试（1周）

#### 3.4.1 用户场景测试

**核心用户场景**:

1. **测试设计人员场景**
   - 上传需求文档 → 分析需求 → 生成测试用例 → 评估用例质量 → 导出用例

2. **测试审核人员场景**
   - 查看待审核用例 → 审核用例 → 查看审核历史

3. **测试管理人员场景**
   - 查看需求列表 → 查看用例统计 → 批量生成用例 → 导出用例报告

#### 3.4.2 兼容性测试

**浏览器兼容性**:
- Chrome（最新版）
- Firefox（最新版）
- Edge（最新版）
- Safari（最新版）

**数据库兼容性**:
- PostgreSQL 14+
- MySQL 8.0+（如需要）

---

## 四、测试环境

### 4.1 测试环境配置

#### 4.1.1 单元测试环境
- **数据库**: H2内存数据库
- **外部服务**: Mock
- **配置**: `application-test.yml`

#### 4.1.2 集成测试环境
- **数据库**: H2内存数据库 或 TestContainers（PostgreSQL）
- **Redis**: 嵌入式Redis 或 Mock
- **外部服务**: Mock
- **配置**: `application-test.yml`

#### 4.1.3 系统测试环境
- **数据库**: PostgreSQL 14+（Docker）
- **Redis**: Redis 7+（Docker）
- **Java服务**: Spring Boot应用
- **Python服务**: FastAPI应用
- **前端**: Vue 3应用

### 4.2 测试数据管理

#### 4.2.1 测试数据准备
- 使用测试数据构建器（Builder模式）
- 使用测试数据初始化脚本
- 使用Fixture管理测试数据

#### 4.2.2 测试数据清理
- 每个测试方法执行后自动清理
- 使用`@Transactional`回滚（集成测试）
- 使用`@DirtiesContext`（如需要）

---

## 五、测试执行计划

### 5.1 时间安排

| 阶段 | 任务 | 预计时间 | 负责人 |
|------|------|----------|--------|
| 第一阶段 | 单元测试补充 | 1-2周 | 开发团队 |
| 第二阶段 | 集成测试框架 | 1周 | 开发团队 |
| 第三阶段 | 系统测试 | 1-2周 | 测试团队 |
| 第四阶段 | 端到端测试 | 1周 | 测试团队 |

**总计**: 4-6周

### 5.2 测试执行流程

```
1. 开发完成功能
   ↓
2. 编写单元测试（开发人员）
   ↓
3. 执行单元测试，覆盖率达标
   ↓
4. 代码审查
   ↓
5. 集成测试（测试人员）
   ↓
6. 系统测试（测试人员）
   ↓
7. 问题修复
   ↓
8. 回归测试
   ↓
9. 测试通过，发布
```

---

## 六、测试工具和框架

### 6.1 Java后端测试工具

| 工具 | 版本 | 用途 |
|------|------|------|
| JUnit 5 | 5.10.x | 单元测试框架 |
| Mockito | 5.x | Mock框架 |
| Spring Boot Test | 3.2.0 | 集成测试框架 |
| AssertJ | 3.24.x | 断言库 |
| JaCoCo | 0.8.11 | 代码覆盖率 |
| TestContainers | 1.19.x | 容器化测试（可选） |

### 6.2 Python服务测试工具

| 工具 | 版本 | 用途 |
|------|------|------|
| pytest | 7.4.x | 测试框架 |
| pytest-cov | 4.1.x | 代码覆盖率 |
| pytest-mock | 3.12.x | Mock框架 |
| httpx | 0.25.x | HTTP客户端测试 |

### 6.3 前端测试工具

| 工具 | 版本 | 用途 |
|------|------|------|
| Vitest | 1.0.x | 测试框架 |
| @vue/test-utils | 2.4.x | Vue组件测试工具 |

### 6.4 系统测试工具

| 工具 | 版本 | 用途 |
|------|------|------|
| Postman | 最新版 | API测试 |
| JMeter | 5.6+ | 性能测试 |
| OWASP ZAP | 最新版 | 安全测试 |

---

## 七、测试覆盖率目标

### 7.1 代码覆盖率目标

| 层级 | 覆盖率目标 | 关键业务覆盖率 |
|------|-----------|---------------|
| Service层 | >70% | >90% |
| Controller层 | >60% | >80% |
| Repository层 | >50% | >70% |
| 工具类 | >80% | >90% |

### 7.2 覆盖率统计

使用JaCoCo生成覆盖率报告：
```bash
mvn clean test jacoco:report
```

覆盖率报告位置：`target/site/jacoco/index.html`

---

## 八、缺陷管理

### 8.1 缺陷等级定义

| 等级 | 定义 | 处理优先级 |
|------|------|-----------|
| P0 - 致命 | 系统崩溃、数据丢失 | 立即修复 |
| P1 - 严重 | 核心功能不可用 | 高优先级 |
| P2 - 一般 | 功能异常但不影响核心流程 | 中优先级 |
| P3 - 轻微 | 界面问题、提示信息错误 | 低优先级 |

### 8.2 缺陷处理流程

```
发现缺陷
   ↓
记录缺陷（缺陷管理系统）
   ↓
分配给开发人员
   ↓
开发人员修复
   ↓
测试人员验证
   ↓
缺陷关闭
```

---

## 九、测试报告

### 9.1 测试报告内容

1. **测试概述**
   - 测试范围
   - 测试环境
   - 测试时间

2. **测试执行情况**
   - 测试用例统计（总数、通过、失败、跳过）
   - 代码覆盖率统计
   - 缺陷统计

3. **测试结果分析**
   - 功能测试结果
   - 性能测试结果
   - 安全测试结果

4. **风险评估**
   - 已知问题
   - 风险点
   - 建议

### 9.2 测试报告模板

测试报告将包含以下部分：
- 执行摘要
- 测试环境
- 测试执行情况
- 测试结果
- 缺陷统计
- 覆盖率报告
- 风险评估
- 结论和建议

---

## 十、测试检查清单

### 10.1 单元测试检查清单

- [ ] 所有Service层都有对应的单元测试
- [ ] 测试覆盖率 >70%
- [ ] 关键业务逻辑覆盖率 >90%
- [ ] 所有测试用例都能通过
- [ ] 测试代码遵循命名规范
- [ ] 测试代码有清晰的注释

### 10.2 集成测试检查清单

- [ ] 所有Controller层都有集成测试
- [ ] 关键接口100%覆盖
- [ ] 异常场景测试完整
- [ ] 测试数据管理规范
- [ ] 测试执行稳定可靠

### 10.3 系统测试检查清单

- [ ] 核心业务流程测试通过
- [ ] 性能指标达标
- [ ] 安全测试通过
- [ ] 兼容性测试通过
- [ ] 用户体验测试通过

---

## 十一、附录

### 11.1 测试数据示例

见 `docs/测试数据示例.md`

### 11.2 测试脚本示例

见 `backend-java/test-design-assistant-core/src/test/README.md`

### 11.3 参考资料

- [JUnit 5 官方文档](https://junit.org/junit5/docs/current/user-guide/)
- [Mockito 官方文档](https://site.mockito.org/)
- [Spring Boot Test 官方文档](https://docs.spring.io/spring-boot/docs/current/reference/html/features.html#features.testing)
- [pytest 官方文档](https://docs.pytest.org/)

---

**文档版本**: v1.0  
**最后更新**: 2024-01-XX  
**维护人**: 测试团队

