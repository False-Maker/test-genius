# 部署前测试验证清单

> **重要提示**: 在部署到生产环境之前，必须完成以下所有测试验证！

## 📋 快速检查清单

### ✅ 一、测试环境准备（必须）

- [ ] 使用Docker Compose启动完整环境
- [ ] 所有服务正常启动（Java后端、Python AI服务、前端、数据库、Redis）
- [ ] 健康检查通过（访问 `/actuator/health` 和 `/health`）
- [ ] 数据库连接正常
- [ ] Redis连接正常
- [ ] 测试数据已初始化

**验证命令**:
```bash
# 启动环境
docker-compose up -d

# 检查服务状态
docker-compose ps

# 检查健康状态
curl http://localhost:8080/actuator/health
curl http://localhost:8000/health
```

---

### ✅ 二、单元测试和集成测试（必须）

#### Java后端测试

- [ ] 运行所有测试：`mvn clean test`
- [ ] 所有231个测试用例通过
- [ ] 生成覆盖率报告：`mvn clean test jacoco:report`
- [ ] 测试覆盖率 ≥ 70%
- [ ] 查看覆盖率报告：`target/site/jacoco/index.html`

**验证命令**:
```bash
cd backend-java/test-design-assistant-core
mvn clean test
mvn clean test jacoco:report
```

#### Python服务测试

- [ ] 运行所有测试：`pytest`
- [ ] 所有测试用例通过（5个测试文件）
- [ ] 生成覆盖率报告：`pytest --cov=app --cov-report=html`
- [ ] 测试覆盖率 ≥ 70%
- [ ] 查看覆盖率报告：`htmlcov/index.html`

**验证命令**:
```bash
cd backend-python/ai-service
pytest
pytest --cov=app --cov-report=html
```

#### 前端测试

- [ ] 运行所有测试：`npm run test`
- [ ] 所有27个测试用例通过
- [ ] 生成覆盖率报告：`npm run test:coverage`
- [ ] 测试覆盖率 ≥ 70%
- [ ] 查看覆盖率报告：`coverage/index.html`

**验证命令**:
```bash
cd frontend
npm run test
npm run test:coverage
```

---

### ✅ 三、功能测试（必须）

#### 需求管理功能

- [ ] 创建需求成功，编码自动生成（REQ-YYYYMMDD-序号）
- [ ] 需求列表查询正常
- [ ] 需求搜索功能正常（按名称、状态）
- [ ] 需求分页功能正常
- [ ] 需求状态流转正常（草稿→审核中→已通过）
- [ ] 需求删除规则正确（已通过/已关闭不能删除）

#### 用例管理功能

- [ ] 创建用例成功，编码自动生成（CASE-YYYYMMDD-序号）
- [ ] 用例审核功能正常（通过/不通过）
- [ ] 已审核用例不能删除
- [ ] 用例导入导出功能正常（Excel）
- [ ] 用例版本管理正常

#### 用例生成功能

- [ ] 单个用例生成成功
- [ ] 任务状态轮询正常（每2秒查询一次）
- [ ] 生成结果正确保存到数据库
- [ ] 批量用例生成成功
- [ ] 批量任务进度查询正常

#### 提示词模板管理

- [ ] 模板创建成功，编码自动生成（TMP-YYYYMMDD-序号）
- [ ] 模板变量替换正常
- [ ] 模板启用/禁用功能正常

#### 文件上传和文档解析

- [ ] 文件上传成功（Word、PDF）
- [ ] 文件大小限制生效（100MB）
- [ ] 文件类型校验正确
- [ ] 文档解析成功（Word、PDF）
- [ ] 内容提取正确

#### 知识库和用例复用

- [ ] 知识库文档添加成功
- [ ] 语义检索功能正常
- [ ] 用例复用功能正常（相似用例搜索、测试套件）

---

### ✅ 四、集成测试（必须）

- [ ] 前后端集成正常（API调用、数据一致性）
- [ ] Java和Python服务集成正常（用例生成服务调用）
- [ ] 服务降级策略生效（Python服务不可用时）
- [ ] 数据库操作正常（CRUD、事务）
- [ ] Redis缓存正常（写入、读取、失效）

---

### ✅ 五、性能测试（重要）

#### 接口性能

- [ ] P95响应时间 < 1秒
- [ ] P99响应时间 < 3秒
- [ ] 错误率 < 0.1%
- [ ] QPS ≥ 100（100并发用户）

**测试工具**: Apache JMeter 或 Postman

#### 数据库性能

- [ ] 查询响应时间 < 500ms
- [ ] 写入响应时间 < 1秒
- [ ] 数据库连接池正常

#### 用例生成性能

- [ ] 单个用例生成平均耗时 < 30秒
- [ ] 批量生成异步处理正常
- [ ] 任务队列正常

#### 系统资源

- [ ] CPU使用率 < 80%
- [ ] 内存使用率 < 80%
- [ ] 磁盘使用率 < 80%

---

### ✅ 六、安全测试（重要）

- [ ] SQL注入防护正常（测试：`' OR '1'='1`）
- [ ] XSS防护正常（测试：`<script>alert('XSS')</script>`）
- [ ] 接口权限验证正常（未授权访问被阻止）
- [ ] 文件上传安全正常（恶意文件被拒绝、大小限制生效）

---

### ✅ 七、端到端测试（重要）

#### 完整用例生成流程

- [ ] 创建需求 → 生成用例 → 审核用例 → 导出用例（完整流程无错误）

#### 用例复用流程

- [ ] 创建用例 → 用例向量化 → 搜索相似用例 → 创建测试套件（流程正常）

---

### ✅ 八、监控和告警验证（重要）

- [ ] Prometheus指标收集正常（访问 `http://localhost:9090`）
- [ ] Grafana Dashboard显示正常（访问 `http://localhost:3001`）
- [ ] 业务指标监控正常（用例生成、模型调用等）
- [ ] 告警规则配置正确
- [ ] 告警触发正常（模拟高CPU、高内存等）
- [ ] 告警通知正常（邮件、企业微信等）
- [ ] 健康检查接口正常（`/actuator/health`）
- [ ] 故障检测正常（停止Redis服务，验证健康检查）

---

### ✅ 九、压力测试（可选但建议）

- [ ] 高并发测试通过（500并发用户，30分钟）
- [ ] 系统稳定性良好（无崩溃、无内存泄漏）
- [ ] 错误率 < 1%
- [ ] 资源使用正常

---

## 📊 测试验证总结报告

**测试执行日期**: ___________  
**测试执行人**: ___________  
**测试环境**: 测试环境 / 预生产环境

### 测试结果汇总

| 测试类型 | 测试用例数 | 通过数 | 失败数 | 通过率 | 状态 |
|---------|-----------|--------|--------|--------|------|
| 单元测试 | 263 | ___ | ___ | ___% | ⬜ |
| 功能测试 | 30 | ___ | ___ | ___% | ⬜ |
| 集成测试 | 10 | ___ | ___ | ___% | ⬜ |
| 性能测试 | 5 | ___ | ___ | ___% | ⬜ |
| 安全测试 | 8 | ___ | ___ | ___% | ⬜ |
| 端到端测试 | 3 | ___ | ___ | ___% | ⬜ |
| 监控告警测试 | 5 | ___ | ___ | ___% | ⬜ |
| **总计** | **324** | **___** | **___** | **___%** | ⬜ |

### 关键指标

- 接口P95响应时间: ______ ms（目标 < 1000ms）⬜
- 接口P99响应时间: ______ ms（目标 < 3000ms）⬜
- 系统错误率: ______%（目标 < 0.1%）⬜
- CPU使用率: ______%（目标 < 80%）⬜
- 内存使用率: ______%（目标 < 80%）⬜

### 发现的问题

1. ⬜ 无问题
2. ⬜ 问题1：________________（已修复/待修复）
3. ⬜ 问题2：________________（已修复/待修复）

### 测试结论

- ⬜ ✅ 所有测试通过，系统可以部署到生产环境
- ⬜ ⚠️ 存在部分问题，需要修复后重新测试
- ⬜ ❌ 存在严重问题，不能部署到生产环境

### 签字确认

- 测试负责人: ___________ 日期: ___________
- 开发负责人: ___________ 日期: ___________
- 项目经理: ___________ 日期: ___________

---

## 🚀 测试验证通过后

完成所有测试验证并填写测试验证总结报告后，可以进入下一阶段：

1. **生产环境部署准备**（见开发进度报告 7.7 章节）
2. **文档完善和用户培训**（见开发进度报告 7.7 章节）
3. **灰度发布和上线**（见开发进度报告 7.7 章节）

---

**文档版本**: 1.0  
**最后更新**: 2024-01-13

