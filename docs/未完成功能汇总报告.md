# 未完成功能汇总报告

> **生成时间**: 2026-01-28
> **分析范围**: 全项目（后端Java、后端Python、前端）
> **报告目的**: 汇总所有未完成功能点，包括TODO注释、空实现方法、文档中提及的待完成项

---

## 一、概述

本项目是一个测试设计助手系统，采用前后端分离架构（Java后端 + Python AI服务 + Vue3前端）。整体完成度约为 **60-70%**，核心框架已搭建完成，但仍有较多细节功能需要实现。

### 统计摘要

| 类别 | 数量 |
|------|------|
| TODO/FIXME 注释 | 约 20 个 |
| 空实现方法（返回null） | 约 15 个 |
| 文档中提及的待完成功能 | 约 25 项 |
| 未创建的文件/服务 | 约 10 个 |

---

## 二、代码中的 TODO 未完成点

### 2.1 后端 Python（AI 服务）

#### 2.1.1 知识库路由
**文件**: `backend-python/ai-service/app/api/knowledge_router.py:338`

```python
# TODO: 保存文件并调用文档处理服务
# 这里需要实现文件保存和文档处理的完整逻辑
```

**涉及已完成部分**:
- `document_parser_service.py` 已实现文档解析功能
- `document_pipeline_service.py` 已实现完整文档处理流程

**需要实现**:
1. 文件保存到本地/对象存储
2. 调用 `DocumentPipelineService` 处理文档
3. 将处理结果保存到数据库

---

#### 2.1.2 知识库同步服务
**文件**: `backend-python/ai-service/app/services/kb_sync_service.py:400-401`

```python
parser = None  # TODO: 创建DocumentParserService实例
chunking_service = None  # TODO: 创建TextChunkingService实例
```

**涉及已完成部分**:
- `DocumentParserService` 已实现 (`document_parser_service.py`)
- `TextChunkingService` 已实现 (`text_chunking_service.py`)

**需要实现**:
1. 实例化 `DocumentParserService`
2. 实例化 `TextChunkingService`
3. 完成文档解析和分块处理逻辑

---

#### 2.1.3 工作流引擎
**文件**: `backend-python/ai-service/app/services/workflow_engine.py:304`

```python
# TODO: 实现完整的循环迭代逻辑
```

**涉及已完成部分**:
- 基础工作流引擎框架已实现
- 节点执行器已实现

**需要实现**:
1. 完整的 for/while 循环逻辑
2. 循环变量管理
3. 循环退出条件判断

---

#### 2.1.4 Agent 通用工具
**文件**: `backend-python/ai-service/app/services/agent_tools/general_tools.py:48`

```python
# TODO: 集成真实的搜索API
```

**涉及已完成部分**:
- `search` 工具框架已实现
- 工具注册机制已实现

**需要实现**:
1. 集成真实搜索API（如 Google Search、Bing Search）
2. 处理搜索结果
3. 返回格式化的搜索结果

---

### 2.2 后端 Java（核心服务）

#### 2.2.1 知识库管理服务
**文件**: `backend-java/.../service/impl/KnowledgeBaseManageServiceImpl.java`

**未完成点 1 - 行号 140**:
```java
// TODO: 添加文档数量检查逻辑
```

**涉及已完成部分**:
- `KnowledgeBaseRepository` 已实现
- 知识库 CRUD API 已实现

**需要实现**:
1. 查询知识库关联的文档数量
2. 如果有文档，提示用户先删除文档
3. 添加事务处理确保数据一致性

---

**未完成点 2 - 行号 403**:
```java
// TODO: 查询文档数量、分块数量、最后同步时间
```

**涉及已完成部分**:
- `KnowledgeDocumentRepository` 已实现
- `KnowledgeBaseSyncLogRepository` 已实现

**需要实现**:
1. 统计知识库的文档数量（通过 `kb_id` 查询 `knowledge_document` 表）
2. 统计分块数量（通过 `doc_id` 关联查询 `knowledge_document_chunk` 表）
3. 查询最后同步时间（从 `knowledge_base_sync_log` 表查询最新记录）

---

**未完成点 3 - 行号 419**:
```java
// TODO: 查询知识库名称、用户名
```

**涉及已完成部分**:
- `KnowledgeBaseRepository` 已实现
- `UserRepository` 已实现（假设）

**需要实现**:
1. 通过 `kb_id` 查询 `knowledge_base` 表获取 `kb_name`
2. 通过 `user_id` 查询用户表获取用户名
3. 填充到 `KnowledgePermissionResponseDTO`

---

#### 2.2.2 告警服务
**文件**: `backend-java/.../service/impl/AlertServiceImpl.java:243`

```java
// TODO: 发送通知
```

**涉及已完成部分**:
- 告警规则检查逻辑已实现
- 告警触发逻辑已实现
- `AppLogAspect` 已实现日志记录

**需要实现**:
1. 邮件通知服务
2. 站内信通知服务
3. 可选：短信通知、Webhook通知
4. 通知发送失败的重试机制

---

#### 2.2.3 日志切面
**文件**: `backend-java/.../config/AppLogAspect.java:281,289`

```java
// TODO: 从SecurityContext或Session获取当前用户ID
// TODO: 从SecurityContext或Session获取当前用户名
```

**涉及已完成部分**:
- AOP 切面配置已完成
- 日志记录逻辑已完成

**需要实现**:
1. 集成 Spring Security 或自定义认证上下文
2. 从 `SecurityContextHolder` 获取当前用户信息
3. 如果未认证，使用匿名用户标识

---

### 2.3 前端（Vue 3）

#### 2.3.1 工作流编辑器
**文件**: `frontend/src/views/workflow/WorkflowEditor.vue:380`

```javascript
// TODO: 实现工作流选择对话框
```

**涉及已完成部分**:
- vue-flow 画布已实现
- 节点拖拽功能已实现

**需要实现**:
1. 工作流列表选择对话框组件
2. 加载已有工作流配置
3. 工作流切换确认

---

#### 2.3.2 Agent 聊天界面
**文件**: `frontend/src/views/agent/AgentChat.vue:185-186`

```javascript
userId: 1,  // TODO: 从用户信息获取
userName: '用户',  // TODO: 从用户信息获取
```

**涉及已完成部分**:
- 聊天界面UI已实现
- 消息发送功能已实现

**需要实现**:
1. 从用户状态管理（Pinia/Vuex）获取当前用户信息
2. 从认证上下文获取用户ID和用户名
3. 用户信息更新时的响应处理

---

#### 2.3.3 智能模型选择
**文件**: `frontend/src/views/intelligent-model/IntelligentModelSelection.vue:282`

```javascript
// TODO: 这里可以集成到实际的模型调用中
```

**涉及已完成部分**:
- `IntelligentModelSelectionService` 后端服务已实现
- 模型推荐算法已实现

**需要实现**:
1. 在用例生成/UI脚本生成等场景中调用智能模型选择API
2. 根据推荐结果自动选择模型
3. 用户可覆盖推荐结果

---

#### 2.3.4 测试执行管理
**文件**: `frontend/src/views/test-execution/TestExecutionManagement.vue:4137`

```javascript
ElMessage.info('创建人任务功能待实现，可通过UI脚本生成或脚本修复页面创建人任务')
```

**涉及已完成部分**:
- 测试执行管理页面已实现
- 任务分配功能已部分实现

**需要实现**:
1. 创建人任务的完整功能
2. 集成 UI 脚本生成页面
3. 集成脚本修复页面

---

## 三、空实现方法（返回 null/空值）

### 3.1 后端 Java 空实现

#### 3.1.1 缓存服务
**文件**: `backend-java/.../service/impl/CacheServiceImpl.java`

**方法**: `get()`, `set()`, `delete()`, `clear()` 等

**涉及已完成部分**:
- Spring Cache 注解配置已完成

**需要实现**:
1. 集成 Redis 或 Caffeine
2. 实现缓存操作逻辑
3. 添加缓存过期策略

---

#### 3.1.2 智能模型选择服务
**文件**: `backend-java/.../service/impl/IntelligentModelSelectionServiceImpl.java:53`

```java
// 没有找到支持任务类型时返回null
```

**需要实现**:
1. 默认模型选择逻辑
2. 模型降级策略
3. 异常处理

---

#### 3.1.3 需求分析服务
**文件**: `backend-java/.../service/impl/RequirementAnalysisServiceImpl.java:136,139`

**需要实现**:
1. 调用 Python AI 服务进行需求分析
2. 解析分析结果
3. 返回结构化需求

---

#### 3.1.4 UI 脚本生成服务
**文件**: `backend-java/.../service/impl/UIScriptGenerationServiceImpl.java:292,301`

**需要实现**:
1. 调用 Python AI 服务生成脚本
2. 脚本格式验证
3. 脚本保存逻辑

---

### 3.2 后端 Python 空实现

#### 3.2.1 Agent 引擎
**文件**: `backend-python/ai-service/app/services/agent_engine.py`

**需要确认实现状态**:
- 流式响应处理
- 工具调用执行
- 多轮对话上下文管理

---

## 四、文档中提及的待完成功能

> 来源: `docs/RAG增强实施总结报告.md`, `docs/Dify框架升级实施计划.md`

### 4.1 RAG Pipeline 增强（第二阶段）

#### 4.1.1 混合检索器 (HybridRetriever)

**文件需要创建**: `backend-python/ai-service/app/services/hybrid_retriever.py`

**涉及已完成部分**:
- `bm25_retriever.py` - BM25 关键词检索已实现
- 向量检索功能已实现（通过 pgvector）

**需要实现**:
1. `HybridRetriever` 类
2. 三种融合策略：
   - **Weighted**: 加权融合，配置向量检索和BM25的权重比例
   - **RRF (Reciprocal Rank Fusion)**: 倒数排名融合
   - **Max**: 取两种检索方法的最大分数
3. 结果去重和排序

---

#### 4.1.2 重排序服务 (RerankerService)

**文件需要创建**: `backend-python/ai-service/app/services/reranker_service.py`

**涉及已完成部分**:
- 检索器已实现

**需要实现**:
1. 集成 BGE-Reranker 或其他交叉编码器模型
2. 批量重排序功能
3. 性能优化（批处理、缓存）

---

#### 4.1.3 多路召回

**涉及已完成部分**:
- `knowledge_base` 表已设计
- 单知识库检索已实现

**需要实现**:
1. 同时从多个知识库检索
2. 结果合并逻辑
3. 跨知识库去重

---

### 4.2 上下文增强（第三阶段）

#### 4.2.1 上下文注入服务

**文件需要创建**: `backend-python/ai-service/app/services/context_injection_service.py`

**涉及已完成部分**:
- `PromptTemplate` 已存在

**需要实现**:
1. 上下文窗口管理（Token 数量控制）
2. 检索结果注入到提示词模板
3. 上下文压缩策略

---

#### 4.2.2 引用溯源

**涉及已完成部分**:
- `knowledge_document_chunk` 表包含 metadata 字段

**需要实现**:
1. 在响应中标注信息来源（文档名、页码等）
2. 引用链接生成
3. 前端引用展示组件

---

### 4.3 知识库管理增强（第四阶段）

#### 4.3.1 权限服务 (KBPermissionService)

**文件需要创建**: `backend-python/ai-service/app/services/kb_permission_service.py`

**涉及已完成部分**:
- `knowledge_base_permission` 表已创建
- Java 后端 `KnowledgeBasePermissionRepository` 已实现

**需要实现**:
1. 权限检查逻辑
2. 用户-知识库关联管理
3. 权限类型验证（read/write/admin）

---

#### 4.3.2 同步服务 (KBSyncService)

**文件**: `backend-python/ai-service/app/services/kb_sync_service.py` (已创建，需完善)

**涉及已完成部分**:
- `knowledge_base_sync_log` 表已创建
- Java 后端同步日志查询已实现

**需要实现**:
1. 增量同步：检测文件变化，只更新变更的文件
2. 全量同步：重新处理所有文件
3. 变化检测机制（文件哈希、修改时间）

---

#### 4.3.3 前端知识库管理界面

**需要创建的文件**:
- `frontend/src/views/knowledge-base/KnowledgeBaseList.vue`
- `frontend/src/views/knowledge-base/KnowledgeBaseDetail.vue`
- `frontend/src/views/knowledge-base/DocumentUpload.vue`
- `frontend/src/api/knowledgeBase.ts`

**涉及已完成部分**:
- Java 后端 API 已实现

**需要实现**:
1. 知识库列表页面（CRUD操作）
2. 文档上传页面
3. 文档搜索页面
4. API 封装

---

### 4.4 Agent 能力（第五阶段）

#### 4.4.1 Agent 应用场景

**需要实现**:
1. 智能测试设计助手对话流程
2. 测试用例优化 Agent
3. Agent 配置管理界面

**涉及已完成部分**:
- Agent 框架已实现
- 工具注册机制已实现

---

#### 4.4.2 Agent 工具开发框架

**需要实现**:
1. 工具开发 SDK/规范
2. 工具权限控制
3. 工具测试框架

---

### 4.5 模型和应用管理（第六阶段）

#### 4.5.1 模型性能对比

**需要实现**:
1. 从 `app_log` 表统计模型性能
2. 性能 Dashboard（前端）
3. 模型推荐算法优化

**涉及已完成部分**:
- `app_log` 表已设计
- `AppLogAspect` 日志记录已实现

---

#### 4.5.2 模型限流和配额

**需要实现**:
1. Redis 限流器
2. 配额管理
3. 优先级队列

---

#### 4.5.3 应用管理

**需要实现**:
1. 应用数据模型
2. 应用管理 API
3. 应用版本管理
4. A/B 测试框架

---

## 五、按优先级分类

### 高优先级（1-2周）

| 序号 | 功能 | 文件位置 | 依赖 |
|------|------|----------|------|
| 1 | 文档上传文件处理逻辑 | `knowledge_router.py:338` | `DocumentPipelineService` |
| 2 | 文档解析/分块实例化 | `kb_sync_service.py:400-401` | `DocumentParserService`, `TextChunkingService` |
| 3 | 知识库删除文档检查 | `KnowledgeBaseManageServiceImpl.java:140` | `KnowledgeDocumentRepository` |
| 4 | 知识库统计信息填充 | `KnowledgeBaseManageServiceImpl.java:403,419` | 各个Repository |

---

### 中优先级（2-4周）

| 序号 | 功能 | 文件位置 | 依赖 |
|------|------|----------|------|
| 1 | 告警通知发送 | `AlertServiceImpl.java:243` | 邮件/消息服务 |
| 2 | 用户信息获取 | `AppLogAspect.java:281,289` | Spring Security集成 |
| 3 | 用户信息获取（前端） | `AgentChat.vue:185-186` | 用户状态管理 |
| 4 | 混合检索器 | `hybrid_retriever.py` (新建) | `bm25_retriever.py`, 向量检索 |
| 5 | 重排序服务 | `reranker_service.py` (新建) | BGE-Reranker模型 |
| 6 | 上下文注入服务 | `context_injection_service.py` (新建) | 检索器, 提示词模板 |
| 7 | 工作流循环逻辑 | `workflow_engine.py:304` | 工作流引擎框架 |

---

### 低优先级（4-8周）

| 序号 | 功能 | 文件位置 | 依赖 |
|------|------|----------|------|
| 1 | 缓存服务实现 | `CacheServiceImpl.java` | Redis/Caffeine |
| 2 | 智能模型集成 | `IntelligentModelSelection.vue:282` | 后端推荐API |
| 3 | 工作流选择对话框 | `WorkflowEditor.vue:380` | 工作流API |
| 4 | 知识库前端界面 | `frontend/src/views/knowledge-base/` | 后端API |
| 5 | 权限服务 | `kb_permission_service.py` (新建) | `knowledge_base_permission`表 |
| 6 | 同步服务完善 | `kb_sync_service.py` | 文档处理服务 |
| 7 | 搜索API集成 | `general_tools.py:48` | 外部搜索API |

---

### 长期规划（8周以上）

| 序号 | 功能 | 描述 |
|------|------|------|
| 1 | 单元测试补充 | 测试覆盖率 > 80% |
| 2 | 模型限流和配额 | Redis限流器、配额管理 |
| 3 | 应用管理框架 | 应用模型、版本管理、A/B测试 |
| 4 | Agent工具SDK | 工具开发规范和测试框架 |
| 5 | 性能优化 | 工作流执行、检索性能、监控查询 |

---

## 六、风险评估

### 高风险

1. **知识库文件上传功能不完整**
   - 影响：核心业务流程阻塞
   - 建议：优先实现文件保存和文档处理逻辑

2. **多个服务返回null**
   - 影响：可能导致 NullPointerException
   - 建议：实现默认逻辑或抛出明确的异常

### 中风险

1. **告警通知未发送**
   - 影响：监控告警无法触达用户
   - 建议：集成邮件/消息服务

2. **用户信息未正确获取**
   - 影响：日志记录不准确，权限控制失效
   - 建议：集成认证上下文

### 低风险

1. **前端功能集成不完整**
   - 影响：用户体验不佳，但不影响核心功能
   - 建议：逐步完善

---

## 七、建议实施顺序

```
第一阶段（紧急修复 - 1-2周）
├── 完成知识库文档上传的文件处理逻辑
├── 实现DocumentParserService和TextChunkingService实例创建
├── 完善知识库删除的文档数量检查
└── 修复返回null的服务方法

第二阶段（核心功能 - 2-4周）
├── 实现告警通知发送功能
├── 完善用户信息获取（前端和后端）
├── 实现混合检索器
├── 实现重排序服务
└── 实现上下文注入服务

第三阶段（增强功能 - 4-8周）
├── 完成工作流循环逻辑
├── 实现知识库前端管理界面
├── 实现权限服务
├── 完善同步服务
└── 集成搜索API

第四阶段（长期优化 - 8周以上）
├── 补充单元测试
├── 实现模型限流和配额
├── 实现应用管理框架
├── 开发Agent工具SDK
└── 性能优化
```

---

**报告版本**: v1.0
**生成方式**: 自动分析（基于代码TODO、文档、空方法检测）
**维护建议**: 每两周更新一次，同步项目进度
