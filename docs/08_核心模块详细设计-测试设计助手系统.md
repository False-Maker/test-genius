# 核心模块详细设计-测试设计助手系统

## 1. 标准化测试设计流程模块

### 1.1 模块概述

#### 1.1.1 功能定位
标准化测试设计流程模块是测试设计助手系统的核心模块之一，旨在建设标准化的测试设计工作台，实现测试设计的全面线上化，提升测试设计效率和质量。

#### 1.1.2 核心能力
- **测试设计规范管理**：融入测试设计规范要求，确保测试设计符合行业标准和公司规范
- **需求理解与分析**：帮助测试人员理解业务需求，识别测试要点
- **测试分层选择**：支持测试人员根据需求选择合适的测试分层
- **测试设计方法选择**：提供多种测试设计方法
- **标准化案例分层结构**：支持个人级、业务案例、功能案例、接口案例、场景案例等分层
- **测试用例管理**：测试用例的创建、编辑、审核、版本管理
- **测试用例复用**：支持测试用例的复用和组合
- **测试设计工作台**：提供可视化的测试设计工作界面

### 1.2 功能模块详细设计

#### 1.2.1 测试设计工作台

##### 1.2.1.1 需求管理
**功能描述**：管理测试需求文档，支持多种格式的文档上传、解析和管理。

**核心功能**：
- 需求文档上传（支持Word、PDF、Markdown等格式）
- 需求文档解析和结构化
- 需求版本管理
- 需求变更追踪
- 需求关联用例查询

**数据模型**：
```sql
-- 需求表
CREATE TABLE test_requirement (
    id BIGINT PRIMARY KEY,
    requirement_code VARCHAR(100) UNIQUE NOT NULL,
    requirement_name VARCHAR(500) NOT NULL,
    requirement_type VARCHAR(50), -- 新功能/优化/缺陷修复
    requirement_description TEXT,
    requirement_doc_url VARCHAR(1000), -- 需求文档存储路径
    requirement_status VARCHAR(50), -- 草稿/审核中/已通过/已关闭
    business_module VARCHAR(100), -- 业务模块：投保/核保/理赔/保全等
    creator_id BIGINT,
    creator_name VARCHAR(100),
    create_time TIMESTAMP,
    update_time TIMESTAMP,
    version INT DEFAULT 1
);

-- 需求附件表
CREATE TABLE test_requirement_attachment (
    id BIGINT PRIMARY KEY,
    requirement_id BIGINT,
    file_name VARCHAR(500),
    file_type VARCHAR(50),
    file_url VARCHAR(1000),
    file_size BIGINT,
    upload_time TIMESTAMP,
    FOREIGN KEY (requirement_id) REFERENCES test_requirement(id)
);
```

##### 1.2.1.2 需求理解与分析引擎

**功能描述**：自动解析需求文档，提取测试要点和业务规则。

**核心功能**：
- 需求文档智能解析
- 测试要点自动识别
- 业务规则提取
- 测试范围分析
- 风险评估

**处理流程**：
1. 接收需求文档
2. 文档格式识别和转换
3. 文档内容解析和结构化
4. 关键信息提取（功能点、业务规则、边界条件等）
5. 测试要点识别和建议
6. 生成需求分析报告

**接口设计**：
```java
/**
 * 需求分析服务接口
 */
public interface RequirementAnalysisService {
    /**
     * 分析需求文档
     * @param requirementId 需求ID
     * @return 需求分析结果
     */
    RequirementAnalysisResult analyzeRequirement(Long requirementId);
    
    /**
     * 提取测试要点
     * @param requirementId 需求ID
     * @return 测试要点列表
     */
    List<TestPoint> extractTestPoints(Long requirementId);
    
    /**
     * 提取业务规则
     * @param requirementId 需求ID
     * @return 业务规则列表
     */
    List<BusinessRule> extractBusinessRules(Long requirementId);
}
```

##### 1.2.1.3 测试分层选择引擎

**功能描述**：根据需求自动推荐或支持手动选择测试分层。

**测试分层定义**：
- **个人级测试（Individual）**：针对个人用户相关功能的测试
  - 个人中心、个人信息管理、密码修改、偏好设置等
- **业务案例测试（Business Case）**：针对完整业务流程的端到端测试
  - 投保流程、理赔流程、保全流程、续期流程等
- **功能案例测试（Functional Case）**：针对具体功能模块的测试
  - 核保功能、保全功能、理赔功能、客户管理功能等
- **接口案例测试（Interface Case）**：针对API接口的测试
  - REST API、SOAP API、消息接口等
- **场景案例测试（Scenario Case）**：针对特定业务场景的测试
  - 异常场景、边界场景、并发场景等

**核心功能**：
- 测试分层自动推荐
- 测试分层手动选择
- 测试分层说明和指导
- 测试分层关联用例查询

**数据模型**：
```sql
-- 测试分层表
CREATE TABLE test_layer (
    id BIGINT PRIMARY KEY,
    layer_code VARCHAR(50) UNIQUE NOT NULL,
    layer_name VARCHAR(100) NOT NULL,
    layer_description TEXT,
    layer_order INT,
    is_active CHAR(1) DEFAULT '1'
);

-- 需求测试分层关联表
CREATE TABLE requirement_test_layer (
    id BIGINT PRIMARY KEY,
    requirement_id BIGINT,
    layer_id BIGINT,
    selection_type VARCHAR(50), -- 自动/手动
    FOREIGN KEY (requirement_id) REFERENCES test_requirement(id),
    FOREIGN KEY (layer_id) REFERENCES test_layer(id)
);
```

##### 1.2.1.4 测试设计方法选择引擎

**功能描述**：根据测试分层和需求特点，推荐合适的测试设计方法。

**测试设计方法**：
- **等价类划分法（Equivalence Partitioning）**：将输入数据划分为等价类
- **边界值分析法（Boundary Value Analysis）**：测试边界值
- **场景法（Scenario Method）**：基于业务场景设计用例
- **决策表法（Decision Table）**：基于规则组合设计用例
- **状态转换法（State Transition）**：基于状态转换设计用例
- **因果图法（Cause-Effect Graphing）**：基于因果关系设计用例

**核心功能**：
- 测试方法自动推荐
- 测试方法手动选择
- 测试方法说明和示例
- 多种方法组合使用

**数据模型**：
```sql
-- 测试设计方法表
CREATE TABLE test_design_method (
    id BIGINT PRIMARY KEY,
    method_code VARCHAR(50) UNIQUE NOT NULL,
    method_name VARCHAR(100) NOT NULL,
    method_description TEXT,
    applicable_layers VARCHAR(500), -- 适用的测试分层
    example TEXT, -- 使用示例
    is_active CHAR(1) DEFAULT '1'
);

-- 需求测试方法关联表
CREATE TABLE requirement_test_method (
    id BIGINT PRIMARY KEY,
    requirement_id BIGINT,
    method_id BIGINT,
    selection_type VARCHAR(50), -- 自动/手动
    FOREIGN KEY (requirement_id) REFERENCES test_requirement(id),
    FOREIGN KEY (method_id) REFERENCES test_design_method(id)
);
```

##### 1.2.1.5 测试用例管理服务

**功能描述**：提供测试用例的完整生命周期管理。

**核心功能**：
- **用例创建**：支持手动创建和自动生成
- **用例编辑**：支持在线编辑和批量编辑
- **用例审核**：支持多级审核流程
- **用例版本管理**：支持用例版本控制和历史追溯
- **用例查询**：支持多维度查询和高级搜索
- **用例导出**：支持多种格式导出（Excel、Word、JSON等）
- **用例导入**：支持批量导入

**数据模型**：
```sql
-- 测试用例表
CREATE TABLE test_case (
    id BIGINT PRIMARY KEY,
    case_code VARCHAR(100) UNIQUE NOT NULL,
    case_name VARCHAR(500) NOT NULL,
    requirement_id BIGINT,
    layer_id BIGINT,
    method_id BIGINT,
    case_type VARCHAR(50), -- 正常/异常/边界
    case_priority VARCHAR(50), -- 高/中/低
    pre_condition TEXT, -- 前置条件
    test_step TEXT, -- 测试步骤
    expected_result TEXT, -- 预期结果
    case_status VARCHAR(50), -- 草稿/待审核/已审核/已废弃
    creator_id BIGINT,
    creator_name VARCHAR(100),
    create_time TIMESTAMP,
    update_time TIMESTAMP,
    version INT DEFAULT 1,
    FOREIGN KEY (requirement_id) REFERENCES test_requirement(id),
    FOREIGN KEY (layer_id) REFERENCES test_layer(id),
    FOREIGN KEY (method_id) REFERENCES test_design_method(id)
);

-- 测试用例审核记录表
CREATE TABLE test_case_review (
    id BIGINT PRIMARY KEY,
    case_id BIGINT,
    reviewer_id BIGINT,
    reviewer_name VARCHAR(100),
    review_result VARCHAR(50), -- 通过/驳回/需修改
    review_comment TEXT,
    review_time TIMESTAMP,
    FOREIGN KEY (case_id) REFERENCES test_case(id)
);

-- 测试用例版本历史表
CREATE TABLE test_case_version (
    id BIGINT PRIMARY KEY,
    case_id BIGINT,
    version INT,
    case_content TEXT, -- 用例完整内容JSON
    change_description TEXT, -- 变更说明
    change_user_id BIGINT,
    change_time TIMESTAMP,
    FOREIGN KEY (case_id) REFERENCES test_case(id)
);
```

##### 1.2.1.6 测试用例复用服务

**功能描述**：支持测试用例的复用和组合，提高用例设计效率。

**核心功能**：
- **用例检索**：基于关键词、标签、业务模块等检索用例
- **相似用例推荐**：基于语义相似度推荐相似用例
- **用例组合**：将多个用例组合成测试套件
- **用例模板管理**：管理用例模板，支持快速创建
- **用例引用**：支持用例之间的引用关系

**数据模型**：
```sql
-- 测试用例标签表
CREATE TABLE test_case_tag (
    id BIGINT PRIMARY KEY,
    case_id BIGINT,
    tag_name VARCHAR(100),
    FOREIGN KEY (case_id) REFERENCES test_case(id)
);

-- 测试用例组合表（测试套件）
CREATE TABLE test_case_suite (
    id BIGINT PRIMARY KEY,
    suite_code VARCHAR(100) UNIQUE NOT NULL,
    suite_name VARCHAR(500) NOT NULL,
    suite_description TEXT,
    creator_id BIGINT,
    create_time TIMESTAMP
);

-- 测试套件用例关联表
CREATE TABLE test_suite_case (
    id BIGINT PRIMARY KEY,
    suite_id BIGINT,
    case_id BIGINT,
    case_order INT, -- 用例执行顺序
    FOREIGN KEY (suite_id) REFERENCES test_case_suite(id),
    FOREIGN KEY (case_id) REFERENCES test_case(id)
);
```

#### 1.2.2 测试设计规范管理

**功能描述**：管理测试设计规范，确保测试设计符合规范要求。

**核心功能**：
- 规范文档管理
- 规范条款管理
- 规范检查规则配置
- 规范符合性检查

**数据模型**：
```sql
-- 测试设计规范表
CREATE TABLE test_design_specification (
    id BIGINT PRIMARY KEY,
    spec_code VARCHAR(100) UNIQUE NOT NULL,
    spec_name VARCHAR(500) NOT NULL,
    spec_version VARCHAR(50),
    spec_content TEXT, -- 规范内容
    is_active CHAR(1) DEFAULT '1',
    effective_date DATE,
    expire_date DATE,
    creator_id BIGINT,
    create_time TIMESTAMP
);

-- 规范检查规则表
CREATE TABLE spec_check_rule (
    id BIGINT PRIMARY KEY,
    spec_id BIGINT,
    rule_code VARCHAR(100),
    rule_name VARCHAR(500),
    rule_description TEXT,
    rule_type VARCHAR(50), -- 必填检查/格式检查/内容检查
    check_expression TEXT, -- 检查表达式
    error_message TEXT,
    FOREIGN KEY (spec_id) REFERENCES test_design_specification(id)
);
```

## 2. 提示词工程用例生成模块

### 2.1 模块概述

#### 2.1.1 功能定位
提示词工程用例生成模块是测试设计助手系统的智能化核心模块，基于大语言模型和提示词工程，自动生成高质量的测试用例，大幅提升测试设计效率。

#### 2.1.2 核心能力
- **提示词模板库**：基于业界测试知识和保险行业特点，构建提示词模板库
- **智能用例生成**：根据需求文档自动生成测试用例
- **公司驱动模型**：通过不同公司（保险公司）的业务特点驱动模型
- **业界测试知识库**：集成业界测试最佳实践和保险行业测试经验
- **用例质量评估**：对生成的测试用例进行质量评估和优化建议
- **多模型支持**：支持调用不同的大语言模型

### 2.2 功能模块详细设计

#### 2.2.1 提示词模板库管理

**功能描述**：管理提示词模板，支持模板的分类、版本控制和效果评估。

**提示词模板分类**：
- 按测试分层分类：个人级、业务案例、功能案例、接口案例、场景案例
- 按测试方法分类：等价类划分、边界值分析、场景法、决策表等
- 按业务模块分类：投保、核保、理赔、保全等
- 按用例类型分类：正常用例、异常用例、边界用例等

**核心功能**：
- 模板创建和编辑
- 模板分类管理
- 模板版本控制
- 模板效果评估
- 模板优化建议
- 模板导入导出

**数据模型**：
```sql
-- 提示词模板表
CREATE TABLE prompt_template (
    id BIGINT PRIMARY KEY,
    template_code VARCHAR(100) UNIQUE NOT NULL,
    template_name VARCHAR(500) NOT NULL,
    template_category VARCHAR(100), -- 模板分类
    template_type VARCHAR(50), -- 提示词类型
    template_content TEXT NOT NULL, -- 模板内容
    template_variables TEXT, -- 模板变量定义JSON
    applicable_layers VARCHAR(500), -- 适用的测试分层
    applicable_methods VARCHAR(500), -- 适用的测试方法
    applicable_modules VARCHAR(500), -- 适用的业务模块
    template_description TEXT,
    version INT DEFAULT 1,
    is_active CHAR(1) DEFAULT '1',
    creator_id BIGINT,
    create_time TIMESTAMP,
    update_time TIMESTAMP
);

-- 提示词模板版本历史表
CREATE TABLE prompt_template_version (
    id BIGINT PRIMARY KEY,
    template_id BIGINT,
    version INT,
    template_content TEXT,
    change_description TEXT,
    change_user_id BIGINT,
    change_time TIMESTAMP,
    FOREIGN KEY (template_id) REFERENCES prompt_template(id)
);

-- 提示词模板效果评估表
CREATE TABLE prompt_template_evaluation (
    id BIGINT PRIMARY KEY,
    template_id BIGINT,
    evaluation_time TIMESTAMP,
    generation_count INT, -- 生成次数
    success_rate DECIMAL(5,2), -- 成功率
    quality_score DECIMAL(5,2), -- 质量评分
    avg_response_time INT, -- 平均响应时间（毫秒）
    evaluation_comment TEXT,
    FOREIGN KEY (template_id) REFERENCES prompt_template(id)
);
```

**提示词模板示例**：
```
模板分类：功能案例-正常用例
模板名称：保险投保功能正常流程测试用例生成

模板内容：
你是一位资深的保险行业测试专家。请根据以下需求，生成功能测试用例。

需求信息：
- 需求名称：{requirement_name}
- 需求描述：{requirement_description}
- 业务模块：{business_module}
- 功能点：{function_points}

测试要求：
1. 测试分层：功能案例测试
2. 测试方法：场景法
3. 用例类型：正常用例
4. 需要覆盖主流程的所有关键步骤
5. 前置条件要明确
6. 测试步骤要详细且可执行
7. 预期结果要具体且可验证

请按照以下格式生成测试用例：
用例编号：TC-{auto_number}
用例名称：{case_name}
测试分层：功能案例
测试方法：场景法
用例类型：正常用例
优先级：{priority}
前置条件：
{pre_condition}

测试步骤：
{test_steps}

预期结果：
{expected_result}

请确保生成的用例符合保险行业测试规范，具有可执行性。
```

#### 2.2.2 智能用例生成引擎

**功能描述**：基于大语言模型和提示词工程，自动生成测试用例。

**核心功能**：
- 需求分析：解析需求文档，提取关键信息
- 测试分层选择：自动选择或推荐合适的测试分层
- 提示词生成：根据需求、分层、方法生成定制化提示词
- 用例生成：调用大模型生成测试用例
- 用例结构化：将生成的用例转换为结构化数据
- 用例优化：对生成的用例进行优化和补全

**处理流程**：
1. 接收需求信息和生成配置
2. 解析需求文档，提取关键信息
3. 选择测试分层和测试方法
4. 从模板库中匹配合适的提示词模板
5. 填充模板变量，生成完整提示词
6. 调用大模型生成测试用例
7. 解析模型返回结果，提取用例信息
8. 结构化用例数据
9. 用例质量评估
10. 用例入库

**接口设计**：
```java
/**
 * 智能用例生成服务接口
 */
public interface IntelligentCaseGenerationService {
    /**
     * 生成测试用例
     * @param request 用例生成请求
     * @return 用例生成结果
     */
    CaseGenerationResult generateTestCases(CaseGenerationRequest request);
    
    /**
     * 批量生成测试用例
     * @param request 批量生成请求
     * @return 批量生成结果
     */
    BatchGenerationResult batchGenerateTestCases(BatchGenerationRequest request);
    
    /**
     * 优化测试用例
     * @param caseId 用例ID
     * @return 优化后的用例
     */
    TestCase optimizeTestCase(Long caseId);
}
```

**数据模型**：
```sql
-- 用例生成请求表
CREATE TABLE case_generation_request (
    id BIGINT PRIMARY KEY,
    request_code VARCHAR(100) UNIQUE NOT NULL,
    requirement_id BIGINT,
    layer_id BIGINT,
    method_id BIGINT,
    template_id BIGINT,
    model_type VARCHAR(50), -- 使用的模型类型
    generation_config TEXT, -- 生成配置JSON
    request_status VARCHAR(50), -- 待处理/处理中/已完成/失败
    total_cases INT, -- 生成用例总数
    success_cases INT, -- 成功生成用例数
    fail_cases INT, -- 失败用例数
    creator_id BIGINT,
    create_time TIMESTAMP,
    complete_time TIMESTAMP,
    FOREIGN KEY (requirement_id) REFERENCES test_requirement(id),
    FOREIGN KEY (template_id) REFERENCES prompt_template(id)
);

-- 用例生成记录表
CREATE TABLE case_generation_log (
    id BIGINT PRIMARY KEY,
    request_id BIGINT,
    case_id BIGINT,
    prompt_text TEXT, -- 使用的提示词
    model_response TEXT, -- 模型返回结果
    generation_status VARCHAR(50), -- 成功/失败
    error_message TEXT,
    generation_time TIMESTAMP,
    response_time INT, -- 响应时间（毫秒）
    FOREIGN KEY (request_id) REFERENCES case_generation_request(id),
    FOREIGN KEY (case_id) REFERENCES test_case(id)
);
```

#### 2.2.3 多模型调用服务

**功能描述**：统一管理多个大语言模型的调用，支持模型切换、对比和融合。

**支持的模型**：
- DeepSeek
- 豆包（字节跳动）
- Kimi（月之暗面）
- 通义千问（阿里巴巴）
- 其他兼容OpenAI API的模型

**核心功能**：
- 模型路由：根据配置选择合适的模型
- 模型切换：支持动态切换模型
- 模型对比：支持同一需求使用多个模型生成，对比效果
- 结果融合：支持多个模型结果的融合
- 模型监控：监控模型调用量、延迟、错误率等

**数据模型**：
```sql
-- 模型配置表
CREATE TABLE model_config (
    id BIGINT PRIMARY KEY,
    model_code VARCHAR(100) UNIQUE NOT NULL,
    model_name VARCHAR(200) NOT NULL,
    model_type VARCHAR(50), -- DeepSeek/豆包/Kimi/千问
    api_endpoint VARCHAR(500),
    api_key VARCHAR(500), -- 加密存储
    model_version VARCHAR(50),
    max_tokens INT,
    temperature DECIMAL(3,2),
    is_active CHAR(1) DEFAULT '1',
    priority INT, -- 优先级，数字越小优先级越高
    daily_limit INT, -- 每日调用限制
    create_time TIMESTAMP,
    update_time TIMESTAMP
);

-- 模型调用记录表
CREATE TABLE model_call_log (
    id BIGINT PRIMARY KEY,
    model_code VARCHAR(100),
    request_id VARCHAR(200),
    prompt_length INT,
    response_length INT,
    tokens_used INT, -- 使用的token数
    response_time INT, -- 响应时间（毫秒）
    call_status VARCHAR(50), -- 成功/失败
    error_message TEXT,
    call_time TIMESTAMP,
    FOREIGN KEY (model_code) REFERENCES model_config(model_code)
);
```

**接口设计**：
```java
/**
 * 模型调用服务接口
 */
public interface ModelCallService {
    /**
     * 调用模型生成内容
     * @param request 模型调用请求
     * @return 模型响应结果
     */
    ModelResponse callModel(ModelRequest request);
    
    /**
     * 多模型对比生成
     * @param request 模型调用请求
     * @param modelCodes 模型代码列表
     * @return 多个模型的响应结果
     */
    Map<String, ModelResponse> compareModels(ModelRequest request, List<String> modelCodes);
    
    /**
     * 获取模型调用统计
     * @param modelCode 模型代码
     * @param startDate 开始日期
     * @param endDate 结束日期
     * @return 统计信息
     */
    ModelCallStatistics getModelStatistics(String modelCode, Date startDate, Date endDate);
}
```

#### 2.2.4 用例质量评估引擎

**功能描述**：对生成的测试用例进行质量评估，提供优化建议。

**评估维度**：
- **覆盖率**：需求覆盖率、功能覆盖率、场景覆盖率
- **完整性**：前置条件完整性、步骤完整性、预期结果完整性
- **可执行性**：步骤清晰度、数据准备难度、环境依赖
- **规范性**：命名规范性、格式规范性、内容规范性
- **准确性**：需求理解准确性、业务逻辑准确性

**核心功能**：
- 自动质量评估
- 评估报告生成
- 优化建议提供
- 质量趋势分析

**数据模型**：
```sql
-- 用例质量评估表
CREATE TABLE test_case_quality (
    id BIGINT PRIMARY KEY,
    case_id BIGINT,
    coverage_score DECIMAL(5,2), -- 覆盖率评分
    completeness_score DECIMAL(5,2), -- 完整性评分
    executability_score DECIMAL(5,2), -- 可执行性评分
    standardization_score DECIMAL(5,2), -- 规范性评分
    accuracy_score DECIMAL(5,2), -- 准确性评分
    total_score DECIMAL(5,2), -- 总分
    quality_level VARCHAR(50), -- 优秀/良好/一般/需改进
    evaluation_details TEXT, -- 评估详情JSON
    optimization_suggestions TEXT, -- 优化建议
    evaluator_id BIGINT,
    evaluation_time TIMESTAMP,
    FOREIGN KEY (case_id) REFERENCES test_case(id)
);

-- 质量评估规则表
CREATE TABLE quality_assessment_rule (
    id BIGINT PRIMARY KEY,
    rule_code VARCHAR(100) UNIQUE NOT NULL,
    rule_name VARCHAR(500) NOT NULL,
    rule_type VARCHAR(50), -- 覆盖率/完整性/可执行性/规范性/准确性
    rule_description TEXT,
    check_expression TEXT, -- 检查表达式
    weight DECIMAL(5,2), -- 权重
    is_active CHAR(1) DEFAULT '1'
);
```

#### 2.2.5 用例生成工作流

**功能描述**：管理用例生成的完整工作流程。

**工作流节点**：
1. 需求输入：上传或选择需求
2. 需求分析：自动分析需求
3. 测试分层选择：选择测试分层
4. 测试方法选择：选择测试方法
5. 提示词生成：生成定制化提示词
6. 用例生成：调用模型生成用例
7. 用例审核：人工审核用例
8. 用例入库：用例入库和关联

**核心功能**：
- 工作流定义和配置
- 工作流执行和监控
- 工作流异常处理
- 工作流历史追溯

**数据模型**：
```sql
-- 用例生成工作流定义表
CREATE TABLE case_generation_workflow (
    id BIGINT PRIMARY KEY,
    workflow_code VARCHAR(100) UNIQUE NOT NULL,
    workflow_name VARCHAR(500) NOT NULL,
    workflow_definition TEXT, -- 工作流定义JSON
    is_default CHAR(1) DEFAULT '0',
    is_active CHAR(1) DEFAULT '1',
    creator_id BIGINT,
    create_time TIMESTAMP
);

-- 用例生成工作流实例表
CREATE TABLE case_generation_workflow_instance (
    id BIGINT PRIMARY KEY,
    workflow_id BIGINT,
    instance_code VARCHAR(100) UNIQUE NOT NULL,
    requirement_id BIGINT,
    current_node VARCHAR(100),
    workflow_status VARCHAR(50), -- 运行中/已完成/已终止/异常
    start_time TIMESTAMP,
    end_time TIMESTAMP,
    FOREIGN KEY (workflow_id) REFERENCES case_generation_workflow(id),
    FOREIGN KEY (requirement_id) REFERENCES test_requirement(id)
);

-- 工作流节点执行记录表
CREATE TABLE workflow_node_execution (
    id BIGINT PRIMARY KEY,
    instance_id BIGINT,
    node_code VARCHAR(100),
    node_name VARCHAR(500),
    execution_status VARCHAR(50), -- 待执行/执行中/成功/失败
    execution_result TEXT,
    start_time TIMESTAMP,
    end_time TIMESTAMP,
    error_message TEXT,
    FOREIGN KEY (instance_id) REFERENCES case_generation_workflow_instance(id)
);
```

## 3. 数据模型设计

### 3.1 核心实体关系图（ERD）

```
test_requirement (需求)
    ├── requirement_test_layer (需求-测试分层)
    ├── requirement_test_method (需求-测试方法)
    ├── test_case (测试用例)
    └── case_generation_request (用例生成请求)

test_case (测试用例)
    ├── test_case_review (用例审核)
    ├── test_case_version (用例版本)
    ├── test_case_tag (用例标签)
    ├── test_case_quality (用例质量)
    └── test_suite_case (套件用例关联)

test_layer (测试分层)
test_design_method (测试设计方法)
prompt_template (提示词模板)
model_config (模型配置)
```

### 3.2 数据字典

关键字段说明：
- 所有表都包含 `id`（主键）、`create_time`（创建时间）、`update_time`（更新时间）
- 状态字段使用枚举值：'1'/'0' 或具体状态字符串
- 版本字段使用整数自增
- 关联关系通过外键约束保证数据完整性

## 4. 接口设计

### 4.1 RESTful API设计

#### 4.1.1 需求管理接口
```
POST   /api/v1/requirements             创建需求
GET    /api/v1/requirements             查询需求列表
GET    /api/v1/requirements/{id}        获取需求详情
PUT    /api/v1/requirements/{id}        更新需求
DELETE /api/v1/requirements/{id}        删除需求
POST   /api/v1/requirements/{id}/analyze 分析需求
```

#### 4.1.2 用例管理接口
```
POST   /api/v1/test-cases               创建用例
GET    /api/v1/test-cases               查询用例列表
GET    /api/v1/test-cases/{id}          获取用例详情
PUT    /api/v1/test-cases/{id}          更新用例
DELETE /api/v1/test-cases/{id}          删除用例
POST   /api/v1/test-cases/{id}/review   审核用例
POST   /api/v1/test-cases/batch-export  批量导出
POST   /api/v1/test-cases/batch-import  批量导入
```

#### 4.1.3 用例生成接口
```
POST   /api/v1/case-generation/generate 生成用例
POST   /api/v1/case-generation/batch    批量生成
GET    /api/v1/case-generation/{id}     查询生成任务
GET    /api/v1/case-generation/{id}/result 获取生成结果
POST   /api/v1/case-generation/{id}/optimize 优化用例
```

#### 4.1.4 提示词模板接口
```
POST   /api/v1/prompt-templates         创建模板
GET    /api/v1/prompt-templates         查询模板列表
GET    /api/v1/prompt-templates/{id}    获取模板详情
PUT    /api/v1/prompt-templates/{id}    更新模板
DELETE /api/v1/prompt-templates/{id}    删除模板
POST   /api/v1/prompt-templates/{id}/evaluate 评估模板效果
```

## 5. 工作流程设计

### 5.1 用例生成工作流

**流程步骤**：
1. 用户上传需求文档或选择已有需求
2. 系统自动解析需求文档
3. 系统推荐测试分层和测试方法（用户可调整）
4. 系统匹配提示词模板，生成定制化提示词
5. 用户确认生成配置（可选择模型、生成数量等）
6. 系统调用大模型生成用例
7. 系统自动进行质量评估
8. 用户审核和优化用例
9. 用例入库，关联需求

**流程图**：
```
需求输入 → 需求分析 → 分层/方法选择 → 提示词生成 
    ↓
生成配置确认 → 模型调用 → 用例生成 → 质量评估
    ↓
人工审核 → 用例优化 → 用例入库
```

## 6. 性能要求

### 6.1 响应时间要求
- 需求文档解析：< 30秒（10MB以内文档）
- 用例生成：< 60秒（单次生成10个用例以内）
- 批量用例生成：< 5分钟（100个用例以内）
- 质量评估：< 10秒（单个用例）
- 用例查询：< 2秒（1000条以内）

### 6.2 并发要求
- 支持同时100个用户在线使用
- 支持同时10个用例生成任务
- 支持同时100个用例查询请求

### 6.3 存储要求
- 需求文档存储：支持单个文件100MB以内
- 用例数据存储：支持百万级用例存储
- 历史数据保留：至少保留3年

## 7. 监控指标

### 7.1 业务监控指标
- 用例生成成功率
- 用例生成平均时间
- 用例质量平均评分
- 用例审核通过率
- 用例复用率
- 需求覆盖率

### 7.2 系统监控指标
- 接口响应时间
- 接口错误率
- 模型调用成功率
- 模型平均响应时间
- 系统资源使用率

### 7.3 用户行为指标
- 日活用户数
- 用例生成次数
- 用例审核次数
- 功能使用频率

## 8. 安全与合规

### 8.1 数据安全
- 需求文档加密存储
- 敏感信息脱敏处理
- 数据访问权限控制
- 数据备份和恢复机制

### 8.2 操作审计
- 所有操作记录审计日志
- 支持操作追溯
- 定期审计报告生成

### 8.3 权限管理
- 基于角色的权限控制（RBAC）
- 细粒度权限控制
- 权限变更审计

## 9. 扩展性设计

### 9.1 功能扩展
- 插件化架构，支持新功能快速扩展
- 支持自定义测试分层
- 支持自定义测试方法
- 支持自定义质量评估规则

### 9.2 模型扩展
- 统一的模型调用接口，易于接入新模型
- 支持模型插件化扩展
- 支持模型效果对比和选择

### 9.3 集成扩展
- 标准化API接口，易于与第三方系统集成
- 支持多种数据格式导入导出
- 支持Webhook通知机制

