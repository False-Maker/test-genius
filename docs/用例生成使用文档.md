# 用例生成使用文档

## 一、概述

测试设计助手系统提供了基于大语言模型的智能用例生成功能，可以根据需求文档、测试分层和测试方法自动生成测试用例。

## 二、功能特性

### 2.1 核心功能

- **需求驱动生成**：基于需求文档自动生成测试用例
- **多测试分层支持**：支持个人级、业务案例、功能案例、接口案例、场景案例等测试分层
- **多测试方法支持**：支持等价类划分、边界值分析、场景法、决策表等测试方法
- **多模型支持**：支持DeepSeek、豆包、Kimi、通义千问等多种大模型
- **提示词模板管理**：支持自定义提示词模板，优化生成效果
- **异步任务处理**：用例生成采用异步方式，支持任务进度查询
- **用例自动解析**：支持JSON、Markdown、纯文本等多种格式的用例解析

### 2.2 技术架构

- **后端服务**：Spring Boot (Java)
- **AI服务**：FastAPI (Python)
- **前端界面**：Vue 3 + TypeScript
- **数据库**：PostgreSQL

## 三、使用流程

### 3.1 前置准备

#### 3.1.1 创建需求

1. 进入"需求管理"页面
2. 点击"新建需求"按钮
3. 填写需求信息：
   - 需求名称：必填
   - 需求描述：必填，详细描述需求内容
   - 需求类型：选择需求类型
   - 优先级：选择优先级
4. 保存需求

#### 3.1.2 配置模型（可选）

1. 进入"模型配置"页面（系统管理）
2. 配置模型信息：
   - 模型名称
   - API密钥
   - API端点
   - 模型参数（温度、最大token数等）
3. 启用模型

#### 3.1.3 配置提示词模板（可选）

1. 进入"提示词模板"页面
2. 创建或选择适用的模板
3. 配置模板变量和内容
4. 启用模板

### 3.2 生成用例

#### 3.2.1 通过前端界面生成

1. 进入"用例生成"页面
2. 选择需求：从下拉列表中选择要生成用例的需求
3. 选择测试分层：选择测试分层（如：功能案例）
4. 选择测试方法：选择测试方法（如：场景法）
5. 选择模型（可选）：如果不选择，将使用默认模型
6. 选择提示词模板（可选）：如果不选择，将自动选择适用的模板
7. 点击"生成用例"按钮
8. 等待生成完成（页面会自动轮询任务状态）
9. 查看生成结果：
   - 成功用例数量
   - 失败用例数量
   - 点击"查看用例"跳转到用例列表页面

#### 3.2.2 通过API接口生成

**请求示例**：

```bash
POST /api/v1/case-generation/generate
Content-Type: application/json

{
  "requirementId": 1,
  "layerCode": "FUNCTIONAL",
  "methodCode": "SCENARIO",
  "modelCode": "DEEPSEEK-001",
  "templateId": 1,
  "creatorId": 1
}
```

**响应示例**：

```json
{
  "code": 200,
  "message": "操作成功",
  "data": {
    "taskId": 1,
    "status": "PROCESSING",
    "message": "用例生成任务已提交，正在处理中..."
  }
}
```

**查询任务状态**：

```bash
GET /api/v1/case-generation/{taskId}
```

**响应示例**：

```json
{
  "code": 200,
  "message": "操作成功",
  "data": {
    "id": 1,
    "taskCode": "TASK-20240101-001",
    "requirementId": 1,
    "status": "SUCCESS",
    "progress": 100,
    "totalCases": 5,
    "successCases": 5,
    "failCases": 0,
    "createTime": "2024-01-01T10:00:00",
    "completeTime": "2024-01-01T10:01:30"
  }
}
```

### 3.3 查看和管理用例

1. 进入"用例管理"页面
2. 查看生成的用例列表
3. 可以编辑、审核、删除用例
4. 支持按需求、状态、名称等条件搜索

## 四、测试分层说明

### 4.1 个人级测试（PERSONAL）

针对个人用户相关功能的测试，如：
- 个人信息管理
- 个人中心功能
- 个人设置等

### 4.2 业务案例测试（BUSINESS）

针对完整业务流程的端到端测试，如：
- 投保流程
- 理赔流程
- 保全流程等

### 4.3 功能案例测试（FUNCTIONAL）

针对具体功能模块的测试，如：
- 核保功能
- 保全功能
- 查询功能等

### 4.4 接口案例测试（INTERFACE）

针对API接口的测试，如：
- RESTful API接口
- 第三方接口调用等

### 4.5 场景案例测试（SCENARIO）

针对特定业务场景的测试，如：
- 异常场景
- 边界场景
- 组合场景等

## 五、测试方法说明

### 5.1 等价类划分法（EQUIVALENCE）

将输入数据划分为等价类，每个等价类选择一个代表性测试用例。

### 5.2 边界值分析法（BOUNDARY）

针对输入数据的边界值进行测试，如最大值、最小值、临界值等。

### 5.3 场景法（SCENARIO）

基于业务场景设计测试用例，覆盖主流程、分支流程、异常流程。

### 5.4 决策表法（DECISION_TABLE）

使用决策表描述复杂的业务规则，生成对应的测试用例。

## 六、提示词模板

### 6.1 模板变量

提示词模板支持以下变量：

- `{requirement_text}`：需求文本
- `{requirement_keywords}`：需求关键词
- `{layer_code}`：测试分层代码
- `{method_code}`：测试方法代码
- `{sentence_count}`：需求句子数量

### 6.2 模板示例

```
请根据以下需求生成测试用例：

需求描述：
{requirement_text}

测试要求：
1. 测试分层：{layer_code}
2. 测试方法：{method_code}
3. 用例类型：正常用例
4. 需要覆盖主流程的所有关键步骤
5. 前置条件要明确
6. 测试步骤要详细且可执行
7. 预期结果要具体且可验证

请按照以下格式生成测试用例：
用例编号：TC-{auto_number}
用例名称：{case_name}
测试分层：{layer_code}
测试方法：{method_code}
用例类型：正常用例
优先级：{priority}
前置条件：
{pre_condition}

测试步骤：
{test_steps}

预期结果：
{expected_result}

请确保生成的用例符合保险行业测试规范，具有可执行性。
```

## 七、常见问题

### 7.1 用例生成失败

**问题**：用例生成任务失败

**可能原因**：
1. 需求描述不完整或为空
2. 模型配置错误或API密钥无效
3. 网络连接问题
4. 模型服务不可用

**解决方案**：
1. 检查需求描述是否完整
2. 检查模型配置是否正确
3. 检查网络连接
4. 尝试使用其他模型

### 7.2 生成的用例质量不高

**问题**：生成的用例不符合预期

**解决方案**：
1. 优化需求描述，使其更加详细和具体
2. 选择合适的提示词模板
3. 调整模型参数（温度、最大token数等）
4. 尝试使用不同的模型
5. 对生成的用例进行人工审核和优化

### 7.3 任务进度查询失败

**问题**：无法查询任务进度

**解决方案**：
1. 检查任务ID是否正确
2. 检查后端服务是否正常运行
3. 查看后端日志排查问题

### 7.4 用例解析失败

**问题**：生成的用例无法正确解析

**解决方案**：
1. 检查模型返回的格式是否符合预期
2. 优化提示词模板，明确要求输出格式
3. 系统会自动降级处理，返回包含原始内容的用例，可手动整理

## 八、最佳实践

### 8.1 需求描述规范

- 需求描述应该详细、具体、清晰
- 包含业务背景、功能描述、业务规则等
- 避免使用模糊、歧义的表述

### 8.2 测试分层选择

- 根据需求特点选择合适的测试分层
- 功能类需求选择"功能案例"
- 流程类需求选择"业务案例"
- 接口类需求选择"接口案例"

### 8.3 测试方法选择

- 数据输入类需求选择"等价类划分"或"边界值分析"
- 流程类需求选择"场景法"
- 规则类需求选择"决策表法"

### 8.4 模型选择

- 优先使用效果好的模型
- 根据需求复杂度选择合适的模型
- 可以尝试多个模型对比效果

### 8.5 用例审核

- 生成的用例需要人工审核
- 检查用例的完整性、可执行性
- 根据实际情况调整和优化用例

## 九、API接口文档

### 9.1 生成用例

**接口地址**：`POST /api/v1/case-generation/generate`

**请求参数**：

| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| requirementId | Long | 是 | 需求ID |
| layerCode | String | 是 | 测试分层代码 |
| methodCode | String | 是 | 测试方法代码 |
| modelCode | String | 否 | 模型代码（不提供则使用默认模型） |
| templateId | Long | 否 | 提示词模板ID（不提供则自动选择） |
| creatorId | Long | 是 | 创建人ID |

**响应参数**：

| 参数名 | 类型 | 说明 |
|--------|------|------|
| taskId | Long | 任务ID |
| status | String | 任务状态（PROCESSING） |
| message | String | 提示信息 |

### 9.2 查询任务状态

**接口地址**：`GET /api/v1/case-generation/{id}`

**路径参数**：

| 参数名 | 类型 | 说明 |
|--------|------|------|
| id | Long | 任务ID |

**响应参数**：

| 参数名 | 类型 | 说明 |
|--------|------|------|
| id | Long | 任务ID |
| taskCode | String | 任务编码 |
| requirementId | Long | 需求ID |
| status | String | 任务状态（PENDING/PROCESSING/SUCCESS/FAILED） |
| progress | Integer | 任务进度（0-100） |
| totalCases | Integer | 总用例数 |
| successCases | Integer | 成功用例数 |
| failCases | Integer | 失败用例数 |
| errorMessage | String | 错误信息 |
| createTime | LocalDateTime | 创建时间 |
| completeTime | LocalDateTime | 完成时间 |

## 十、更新记录

| 版本 | 日期 | 更新内容 | 更新人 |
|------|------|----------|--------|
| 1.0 | 2024-01-01 | 初始版本 | 系统 |

---

**文档结束**

*如有问题，请联系系统管理员或查看系统日志。*

